---
phase: 45-outputs-page
plan: "02"
type: execute
wave: 2
depends_on: ["45-01"]
files_modified:
  - src/app/workshop/[sessionId]/outputs/outputs-content.tsx
  - src/components/workshop/deliverable-detail-view.tsx
  - src/components/workshop/synthesis-summary-view.tsx
  - src/components/workshop/step-container.tsx
  - src/components/workshop/output-panel.tsx
autonomous: true
requirements: [OUT-03, OUT-04, OUT-05, OUT-06]

must_haves:
  truths:
    - "User can click a deliverable card and see the full rendered Markdown content"
    - "User can copy the entire deliverable content to clipboard with one click"
    - "User can download the deliverable as a .md file"
    - "User can download the deliverable as a .json file"
    - "View on Outputs Page button in Step 10 navigates to the outputs page"
  artifacts:
    - path: "src/components/workshop/deliverable-detail-view.tsx"
      provides: "Detail view component with markdown rendering, copy, and download"
      min_lines: 80
    - path: "src/app/workshop/[sessionId]/outputs/outputs-content.tsx"
      provides: "Updated outputs content with detail view integration"
      min_lines: 60
    - path: "src/components/workshop/synthesis-summary-view.tsx"
      provides: "Updated View on Outputs Page button with navigation"
      min_lines: 50
  key_links:
    - from: "src/components/workshop/deliverable-detail-view.tsx"
      to: "react-markdown"
      via: "import"
      pattern: "import ReactMarkdown"
    - from: "src/app/workshop/[sessionId]/outputs/outputs-content.tsx"
      to: "src/components/workshop/deliverable-detail-view.tsx"
      via: "import and render"
      pattern: "DeliverableDetailView"
    - from: "src/components/workshop/synthesis-summary-view.tsx"
      to: "/workshop/[sessionId]/outputs"
      via: "Link or router.push"
      pattern: "outputs"
---

<objective>
Add detail view with rendered Markdown, copy-to-clipboard, file download, and wire the 'View on Outputs Page' navigation from Step 10.

Purpose: Users need to read, copy, and download their generated deliverables. The detail view renders the full Markdown content with proper formatting. Copy and download enable users to take their Build Pack into external tools (AI coders, project management, etc.). Wiring the navigation from Step 10 completes the user flow.

Output: Fully interactive outputs page with detail view, copy, download (.md + .json), and end-to-end navigation from Step 10.
</objective>

<execution_context>
@/Users/michaelchristie/.claude/get-shit-done/workflows/execute-plan.md
@/Users/michaelchristie/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@.planning/phases/45-outputs-page/45-01-SUMMARY.md

@src/app/workshop/[sessionId]/outputs/outputs-content.tsx
@src/components/workshop/synthesis-summary-view.tsx
@src/components/workshop/prd-viewer-dialog.tsx
@src/components/workshop/deliverable-card.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create deliverable detail view component with markdown, copy, and download</name>
  <files>
    src/components/workshop/deliverable-detail-view.tsx
    src/app/workshop/[sessionId]/outputs/outputs-content.tsx
  </files>
  <action>
**deliverable-detail-view.tsx:**

`'use client';` component that receives a deliverable and renders its content with action buttons.

Props:
```ts
interface DeliverableDetailViewProps {
  title: string;
  type: string;
  formats: Array<{ id: string; formatType: 'markdown' | 'json' | 'pdf'; content: string | null }>;
  onBack: () => void;
}
```

Layout:
1. Back button at top: `<button onClick={onBack}>` with ArrowLeft icon + "Back to deliverables"
2. Title: `<h2>` showing full deliverable title (e.g., "Product Requirements Document")
3. Action buttons row below title:
   - "Copy Markdown" button: uses `navigator.clipboard.writeText(markdownContent)` with Check icon feedback (reuse the pattern from prd-viewer-dialog.tsx CopyButton). Uses toast.success('Copied to clipboard') from sonner.
   - "Download .md" button: creates a Blob from markdown content, creates a download link via URL.createObjectURL, programmatically clicks it. Filename: `${title-slug}.md` (slugify: lowercase, replace spaces with hyphens, remove special chars).
   - "Download .json" button: same Blob/download pattern with JSON content. Filename: `${title-slug}.json`
   - If a format is missing (null content), disable that button
4. Content area: render the markdown format content using `<ReactMarkdown>` from 'react-markdown' (already in package.json).
   - Wrap in: `<div className="prose prose-sm dark:prose-invert max-w-none">` for proper markdown styling
   - If markdown content is null, show "Markdown content not available" message
5. Optional JSON tab: Use shadcn Tabs component with "Rendered" and "JSON" tabs
   - "Rendered" tab: the ReactMarkdown rendering above
   - "JSON" tab: pretty-printed JSON in a `<pre>` block with monospace font, wrapped in a scrollable container

Imports:
- `import ReactMarkdown from 'react-markdown';`
- `import { ArrowLeft, Copy, Check, Download, FileText, Code } from 'lucide-react';`
- `import { Button } from '@/components/ui/button';`
- `import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';`
- `import { toast } from 'sonner';`
- `import { useState } from 'react';`

Download helper (define inside the file):
```ts
function downloadFile(content: string, filename: string, mimeType: string) {
  const blob = new Blob([content], { type: mimeType });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = filename;
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
}
```

Slug helper:
```ts
function slugify(text: string): string {
  return text.toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/^-|-$/g, '');
}
```

Olive theming: buttons use variant="outline" with olive hover states. Active tab follows existing TabsTrigger styling. Content area uses bg-card with border.

**outputs-content.tsx updates:**

Integrate the detail view:
1. When `selectedType` is set (from card click in Plan 01), find the matching deliverable from the props
2. If selectedType is set: render `<DeliverableDetailView deliverable={selected} onBack={() => setSelectedType(null)} />`
3. If selectedType is null: render the card grid (existing from Plan 01)
4. Update card onClick to `setSelectedType(deliverable.type)`
5. Ensure cards have a clear visual affordance — add ArrowRight icon on each card footer button

Import `DeliverableDetailView` from `@/components/workshop/deliverable-detail-view`.
  </action>
  <verify>Run `npx tsc --noEmit` — no type errors. Navigate to outputs page, click a deliverable card — detail view renders with Markdown content. Click "Copy Markdown" — clipboard contains the content. Click "Download .md" — browser downloads a .md file. Click "Download .json" — browser downloads a .json file. Click "Back to deliverables" — returns to card grid.</verify>
  <done>Detail view renders full Markdown content. Copy, .md download, and .json download all work. Navigation between card grid and detail view is smooth.</done>
</task>

<task type="auto">
  <name>Task 2: Wire 'View on Outputs Page' navigation from Step 10</name>
  <files>
    src/components/workshop/synthesis-summary-view.tsx
    src/components/workshop/step-container.tsx
    src/components/workshop/output-panel.tsx
  </files>
  <action>
In `synthesis-summary-view.tsx`, update both `SynthesisSummaryView` and `SynthesisBuildPackSection` components:

1. Add a new prop `sessionId?: string` to both component interfaces. This is needed to construct the outputs page URL.

2. For PRD and Tech Specs cards that show `buttonLabel: 'View on Outputs Page'` when generation is done:
   - Currently the button is `disabled={!workshopCompleted || isPrdDone}` with no onDownload — making it unclickable
   - Change: when `isPrdDone` (or `isTechSpecsDone`), render the button as a Link (or use `onClick` with `router.push`) to navigate to `/workshop/${sessionId}/outputs`
   - Implementation approach: wrap the DeliverableCard with a conditional. When done, replace the card's `onDownload` with an onClick that calls `router.push(/workshop/${sessionId}/outputs)`. Keep `disabled={false}` so the button is clickable.
   - Alternative simpler approach: when `isPrdDone`, set `disabled={false}` and set `onDownload={() => router.push(/workshop/${sessionId}/outputs)}`. Change the button label to 'View on Outputs Page'.
   - **Guard:** Only show the 'View on Outputs Page' button when `sessionId` is provided. If `sessionId` is undefined (e.g., rendered from output-panel.tsx without sessionId), keep the button disabled or hidden to avoid navigating to `/workshop/undefined/outputs`.

3. Import `useRouter` from `next/navigation` in the component file (it's already a 'use client' component).

4. Add `const router = useRouter();` inside both components.

5. Update ALL callers that pass props to these components:
   - In `step-container.tsx`: pass `sessionId` prop to `SynthesisBuildPackSection` — the sessionId is already available in the step container context
   - In `results-content.tsx`: pass `sessionId` prop to both `SynthesisSummaryView` and `SynthesisBuildPackSection` — sessionId is already a prop
   - In `output-panel.tsx`: pass `sessionId` prop to `SynthesisSummaryView` — extract sessionId from the URL params or from the workshop store. Check if `output-panel.tsx` has access to sessionId (e.g., from `useParams()` or from its own props). If sessionId is available, pass it. If not available, the guard in step 2 above ensures the button stays disabled/hidden.

**Important:** Do NOT change any other behavior. Keep generation flow (idle → loading → done/error) exactly the same. Only change what happens when the card is in `done` state — instead of being a dead disabled button, it now navigates.
  </action>
  <verify>Run `npx tsc --noEmit` — no type errors. Navigate to Step 10 of a completed workshop. Generate a PRD. After generation completes ('done' state), click 'View on Outputs Page' — browser navigates to `/workshop/[sessionId]/outputs`. Same for Tech Specs. From results page: same behavior.</verify>
  <done>'View on Outputs Page' button in Step 10 and results page navigates to the outputs page. Generation flow unchanged.</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with zero errors
2. Clicking a deliverable card on outputs page opens a detail view with rendered Markdown
3. "Copy Markdown" copies full content to clipboard
4. "Download .md" downloads a valid Markdown file
5. "Download .json" downloads a valid JSON file
6. "Back to deliverables" returns to the card grid
7. 'View on Outputs Page' in Step 10 navigates to outputs page
8. 'View on Outputs Page' on results page navigates to outputs page
</verification>

<success_criteria>
- Detail view renders Markdown content with proper formatting (prose styles)
- Copy to clipboard works with visual feedback
- Download produces valid .md and .json files with sensible filenames
- End-to-end flow: Step 10 → Generate → View on Outputs Page → See content → Copy/Download
- Navigation from Step 10 and results page both work
</success_criteria>

<output>
After completion, create `.planning/phases/45-outputs-page/45-02-SUMMARY.md`
</output>
