---
phase: 16-split-screen-layout
plan: 03
type: execute
wave: 3
depends_on: ["16-02"]
files_modified:
  - src/components/workshop/step-container.tsx
  - src/components/workshop/right-panel.tsx
  - src/components/workshop/mobile-tab-bar.tsx
  - src/components/workshop/output-accordion.tsx
autonomous: false

must_haves:
  truths:
    - "Split-screen layout verified working on desktop and mobile"
    - "All LAYOUT requirements (01-04) verified by human"
    - "No regressions in existing functionality (chat, canvas, extraction, step 8)"
  artifacts: []
  key_links: []
---

<objective>
Polish and verify the complete split-screen layout across desktop and mobile viewports. Fix any issues found during build verification and visual testing.

Purpose: Final verification pass ensuring all four LAYOUT requirements are met, no regressions exist, and the layout feels polished. This plan addresses any edge cases or visual issues from Plans 01 and 02.

Output: Polished, verified split-screen layout ready for Phase 17+ features
</objective>

<execution_context>
@/Users/michaelchristie/.claude/get-shit-done/workflows/execute-plan.md
@/Users/michaelchristie/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/16-split-screen-layout/16-CONTEXT.md
@.planning/phases/16-split-screen-layout/16-01-SUMMARY.md
@.planning/phases/16-split-screen-layout/16-02-SUMMARY.md
@src/components/workshop/step-container.tsx
@src/components/workshop/right-panel.tsx
@src/components/workshop/mobile-tab-bar.tsx
@src/components/workshop/output-accordion.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build verification and automated polish</name>
  <files>
    src/components/workshop/step-container.tsx
    src/components/workshop/right-panel.tsx
    src/components/workshop/mobile-tab-bar.tsx
    src/components/workshop/output-accordion.tsx
  </files>
  <action>
Run comprehensive verification and fix any issues found:

**1. Build and type check:**
```bash
npx tsc --noEmit
npm run build
```
Fix any TypeScript errors or build failures.

**2. Structural verification via grep:**
Verify all CONTEXT.md decisions are implemented:

- `autoSaveId="workshop-panels"` in step-container.tsx (panel persistence)
- `defaultSize={25}` or similar narrow default for chat panel (~320px)
- `CanvasWrapper` imported in right-panel.tsx (canvas on ALL steps)
- `OutputAccordion` imported in right-panel.tsx (output as accordion)
- `MobileTabBar` imported in step-container.tsx (mobile tabs)
- `chatCollapsed` state in step-container.tsx (collapsible chat)
- `canvasCollapsed` state in step-container.tsx (collapsible canvas)
- `w-0` on Separator (invisible divider)
- `mobileTab` state with `'chat'` default (chat is default mobile tab)
- `hidden` class for tab content switching (both mounted, CSS toggle)
- `stepOrder === 8` early return still present (step 8 unchanged)

**3. Fix issues found during grep verification.** Common problems to check:
- OutputAccordion: Verify the expand/collapse toggle works (state managed correctly)
- RightPanel: Verify canvas section uses `relative` positioning if collapse button is `absolute`
- Mobile: Verify the `hidden` class is properly toggled (not breaking canvas rendering when hidden)
- Desktop collapse: Verify collapsed strip renders correctly (40px width, centered icon)
- StepNavigation: Verify it still spans full width across both panels on desktop

**4. Lint check:**
```bash
npm run lint
```
Fix any linting issues.

**5. Edge case fixes:**
- Ensure both-panels-collapsed state has a reasonable UX on desktop
- Ensure step 8 IdeationSubStepContainer is not affected by any of the layout changes
- Ensure canvas auto-save still works (CanvasStoreProvider wraps at page level, should be fine)
- Ensure mobile tab state resets to 'chat' when navigating between steps (add step dependency to state)
  </action>
  <verify>
`npx tsc --noEmit` passes. `npm run build` succeeds. `npm run lint` has no errors related to new/modified files. All grep checks pass for required patterns.
  </verify>
  <done>
Build passes, types check, no lint errors. All CONTEXT.md decisions verified present in code. Edge cases handled. Ready for human verification.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Human verification of complete split-screen layout</name>
  <files>
    src/components/workshop/step-container.tsx
    src/components/workshop/right-panel.tsx
    src/components/workshop/mobile-tab-bar.tsx
    src/components/workshop/output-accordion.tsx
  </files>
  <action>
Human verifies the complete split-screen layout across desktop and mobile. No code changes -- this is a visual verification checkpoint.

What was built:
- Desktop: Chat (320px default) left, Canvas+Output right, invisible divider, resizable, both panels collapsible
- Mobile: Tab-based switching between Chat and Canvas, bottom tab bar
- Output accordion at bottom of right panel (appears when artifact extracted)
- Panel sizes persist across steps (autoSaveId)

How to verify:

1. Desktop layout (LAYOUT-01, LAYOUT-02, LAYOUT-03):
   - Visit any workshop step (e.g., http://localhost:3000/workshop/{sessionId}/step/1)
   - Verify: Chat panel on left (~320px), canvas on right (takes remaining space)
   - Verify: Divider is invisible -- hover over the boundary between panels to see it highlight
   - Verify: Drag the divider to resize panels -- sizes should feel responsive
   - Navigate to another step -- verify panel sizes PERSIST (same width as you set)
   - Refresh the page -- verify panel sizes still persist

2. Canvas on all steps:
   - Visit Step 1, Step 3, Step 5, Step 7 -- canvas should be visible on ALL of them
   - Visit Step 8 -- should use the special IdeationSubStepContainer (unchanged from before)

3. Output accordion (LAYOUT-03):
   - On a step with an extracted artifact (or extract one via chat), verify:
     - "Output" accordion appears at bottom of right panel
     - Click to expand -- takes bottom ~50% of right panel, canvas compressed to top
     - ArtifactConfirmation (Looks Good / Edit) buttons visible inside expanded accordion
     - Click to collapse -- just the "Output" label bar remains

4. Desktop collapse/expand:
   - Click the collapse button on the chat panel -- should shrink to thin strip with chat icon
   - Canvas should now take full width
   - Click expand on the thin strip -- chat panel returns
   - Click collapse on the canvas panel -- chat should take full width
   - Click expand -- canvas returns
   - Try collapsing both -- verify reasonable UX (both strips visible)

5. Mobile layout (LAYOUT-04):
   - Resize browser to less than 768px width (or use DevTools responsive mode)
   - Verify: Tab bar appears at bottom with "Chat" and "Canvas" tabs
   - Verify: Chat tab is active by default
   - Tap Canvas tab -- canvas view appears, chat is hidden
   - Tap Chat tab -- chat returns, scroll position preserved
   - Verify: Step navigation is below the tab bar at the very bottom
   - Verify: Tab switching is instant (no loading spinner)

6. No regressions:
   - Chat still works (type messages, get AI responses)
   - Extract Output button still appears after enough messages
   - Step 8 still uses sub-step tabs layout
   - Step navigation (Next/Back) still works
   - Canvas post-it creation still works
  </action>
  <verify>Human visually confirms all 6 verification areas pass.</verify>
  <done>All LAYOUT-01 through LAYOUT-04 requirements verified by human. No regressions found. Split-screen layout approved for production.</done>
</task>

</tasks>

<verification>
**LAYOUT-01:** User sees chat panel left, right panel right on all steps
**LAYOUT-02:** User can resize the divider between chat and right panel
**LAYOUT-03:** Output accordion at bottom of right panel when artifact extracted
**LAYOUT-04:** On mobile (<768px), tabs to switch between Chat and Canvas

All four requirements verified by both automated checks (Task 1) and human visual inspection (Task 2).
</verification>

<success_criteria>
1. `npm run build` succeeds
2. `npx tsc --noEmit` passes
3. Human approves desktop layout (split-screen, resize, collapse)
4. Human approves mobile layout (tab switching)
5. Human approves output accordion behavior
6. Human confirms no regressions
</success_criteria>

<output>
After completion, create `.planning/phases/16-split-screen-layout/16-03-SUMMARY.md`
</output>
