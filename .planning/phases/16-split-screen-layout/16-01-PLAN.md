---
phase: 16-split-screen-layout
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/workshop/step-container.tsx
  - src/components/workshop/right-panel.tsx
autonomous: true
user_setup: []

must_haves:
  truths:
    - "User sees chat panel left, right panel right on all steps (1-7, 9-10; step 8 unchanged)"
    - "User can resize the divider between chat and right panel"
    - "Steps without canvas show placeholder content in right panel (output panel when artifact exists, placeholder when no artifact)"
    - "On mobile (<768px), chat stacks above right panel vertically"
  artifacts:
    - path: "src/components/workshop/right-panel.tsx"
      provides: "Dedicated right panel component with conditional canvas/output/placeholder rendering"
      exports: ["RightPanel"]
    - path: "src/components/workshop/step-container.tsx"
      provides: "Refactored layout using RightPanel as dedicated right panel content"
      contains: "RightPanel"
  key_links:
    - from: "src/components/workshop/step-container.tsx"
      to: "src/components/workshop/right-panel.tsx"
      via: "import and render in Panel"
      pattern: "import.*RightPanel.*right-panel"
    - from: "src/components/workshop/right-panel.tsx"
      to: "src/components/workshop/output-panel.tsx"
      via: "renders OutputPanel when artifact exists"
      pattern: "OutputPanel"
    - from: "src/components/workshop/right-panel.tsx"
      to: "src/components/canvas/canvas-wrapper.tsx"
      via: "renders CanvasWrapper for canvas-enabled steps"
      pattern: "CanvasWrapper"
    - from: "src/components/workshop/step-container.tsx"
      to: "react-resizable-panels"
      via: "Group/Panel/Separator for desktop layout"
      pattern: "Group.*orientation.*horizontal"
---

<objective>
Refactor the step-container layout so the right panel is a dedicated component that conditionally shows canvas, output panel, or placeholder content. Chat stays left, right panel content stays right, with resizable divider on desktop and vertical stacking on mobile.

Purpose: Implements LAYOUT-01 through LAYOUT-04 requirements. Currently the right panel bundles canvas + output panel + artifact confirmation in a stacked layout. This refactoring separates concerns: the right panel becomes a first-class component that renders the appropriate content based on step type and artifact state.

Output: `right-panel.tsx` (new), refactored `step-container.tsx`
</objective>

<execution_context>
@/Users/michaelchristie/.claude/get-shit-done/workflows/execute-plan.md
@/Users/michaelchristie/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/16-split-screen-layout/16-RESEARCH.md
@src/components/workshop/step-container.tsx
@src/components/workshop/output-panel.tsx
@src/components/workshop/chat-panel.tsx
@src/components/canvas/canvas-wrapper.tsx
@src/components/workshop/ideation-sub-step-container.tsx
@src/components/workshop/step-navigation.tsx
@src/components/workshop/artifact-confirmation.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create RightPanel component and refactor step-container layout</name>
  <files>
    src/components/workshop/right-panel.tsx
    src/components/workshop/step-container.tsx
  </files>
  <action>
Create a new `src/components/workshop/right-panel.tsx` component that serves as the dedicated right panel content for all non-step-8 steps.

**RightPanel component (`right-panel.tsx`):**

Props interface:
```typescript
interface RightPanelProps {
  stepOrder: number;
  sessionId: string;
  workshopId: string;
  artifact: Record<string, unknown> | null;
  isExtracting: boolean;
  extractionError: string | null;
  onRetry?: () => void;
  artifactConfirmed: boolean;
  onConfirm: () => void;
  onEdit: () => void;
}
```

Rendering logic (priority order):
1. **If step has canvas** (currently no steps besides 8, but future-proof with a `CANVAS_STEPS` set -- use `const CANVAS_STEPS = new Set<number>([])` for now, empty because step 8 uses IdeationSubStepContainer): Render `<CanvasWrapper>` full height.
2. **If artifact exists OR isExtracting OR extractionError**: Render `<OutputPanel>` with the existing artifact/extraction props, plus `<ArtifactConfirmation>` below when artifact exists. This replaces the placeholder when the user has extracted output.
3. **Default (no canvas, no artifact)**: Render placeholder with centered content:
   - A subtle icon (use `PanelRight` from lucide-react, not an emoji)
   - Heading: "Workspace"
   - Subtext: "AI-generated outputs will appear here as you progress through the conversation."
   - Use `text-muted-foreground` styling, `flex items-center justify-center h-full`

The component should be 'use client' and import OutputPanel, ArtifactConfirmation, CanvasWrapper.

**Refactor `step-container.tsx`:**

1. Remove the `renderOutput()` function entirely.
2. Remove the CanvasWrapper import (it moves to right-panel.tsx).
3. Import the new `RightPanel` component.
4. In the desktop layout: Replace `{renderOutput()}` in the right Panel with:
   ```tsx
   <RightPanel
     stepOrder={stepOrder}
     sessionId={sessionId}
     workshopId={workshopId}
     artifact={artifact}
     isExtracting={isExtracting}
     extractionError={extractionError}
     onRetry={extractArtifact}
     artifactConfirmed={artifactConfirmed}
     onConfirm={handleConfirm}
     onEdit={handleEdit}
   />
   ```
5. In the mobile layout: Replace `{renderOutput()}` with the same `<RightPanel>` component.
6. Keep the `renderContent()` function as-is (chat panel with extract button).
7. Keep the step 8 early return to IdeationSubStepContainer unchanged.
8. Keep the existing isMobile detection, Group/Panel/Separator, StepNavigation, ResetStepDialog exactly as they are.
9. Keep panel sizing: left panel `defaultSize={50} minSize={30}`, right panel `defaultSize={50} minSize={25}`.
10. Keep the existing Separator with touch-friendly hit area unchanged.

**Important:** Do NOT change the ArtifactConfirmation import in step-container.tsx -- remove it from there since it moves into RightPanel. The extract button ("Extract Output") stays in `renderContent()` (left panel, below chat) as it currently is.
  </action>
  <verify>
Run `npx tsc --noEmit` -- no TypeScript errors. Run `npm run build` -- build succeeds. Verify `right-panel.tsx` exists and exports `RightPanel`. Verify `step-container.tsx` imports `RightPanel` and no longer imports `CanvasWrapper` or `ArtifactConfirmation`.
  </verify>
  <done>
Desktop: chat panel left with extract button, right panel shows placeholder (no artifact) or output panel (with artifact) for steps 1-7 and 9-10. Step 8 unchanged (uses IdeationSubStepContainer). Mobile: chat stacks above right panel vertically. Resizable divider works between panels on desktop. TypeScript compiles and Next.js builds successfully.
  </done>
</task>

<task type="auto">
  <name>Task 2: Verify responsive layout and panel behavior across viewports</name>
  <files>
    src/components/workshop/step-container.tsx
    src/components/workshop/right-panel.tsx
  </files>
  <action>
Run the dev server (`npm run dev`) and verify the layout works correctly. Then make any necessary CSS/layout fixes discovered during verification.

**Verification steps (automated via build + grep checks):**

1. Verify the desktop layout structure:
   - `step-container.tsx` uses `Group orientation="horizontal"` with two `Panel` components and a `Separator` between them
   - Left panel renders `renderContent()` (ChatPanel + extract button)
   - Right panel renders `<RightPanel>`

2. Verify the mobile layout structure:
   - `isMobile` state triggers vertical stacking
   - Chat panel div has `border-b` class for visual separation
   - Right panel renders below chat
   - No `Group`/`Panel`/`Separator` in mobile path (plain flexbox)

3. Verify `right-panel.tsx` handles all three states:
   - Grep for `CANVAS_STEPS` (future-proof canvas detection)
   - Grep for `OutputPanel` (artifact state)
   - Grep for `Workspace` or placeholder text (default state)
   - Grep for `ArtifactConfirmation` (confirmation UI when artifact exists)

4. Verify no regression in step 8:
   - Grep for `stepOrder === 8` in step-container.tsx (early return to IdeationSubStepContainer)
   - Confirm IdeationSubStepContainer import still present

5. Final build check:
   - Run `npm run build` to confirm production build succeeds with no errors
   - This catches SSR issues, missing imports, type errors

If any layout issues are found during these checks, fix them in the same task. Common issues to watch for:
- Right panel not taking full height (needs `h-full` on RightPanel root div)
- Output panel overflow (needs `overflow-y-auto` on scrollable content)
- Placeholder not centering (needs `flex items-center justify-center h-full`)
  </action>
  <verify>
`npm run build` passes. Grep confirms: `Group orientation="horizontal"` in desktop path, `isMobile` conditional rendering, `CANVAS_STEPS` in right-panel.tsx, `OutputPanel` rendered conditionally, placeholder "Workspace" text present, `ArtifactConfirmation` in right-panel.tsx, `stepOrder === 8` early return in step-container.tsx.
  </verify>
  <done>
Split-screen layout verified: chat left, right panel right on desktop with resizable divider. Mobile stacks vertically. Steps without canvas show placeholder (or output panel when artifact extracted). Step 8 unchanged. Production build succeeds.
  </done>
</task>

</tasks>

<verification>
**LAYOUT-01:** Chat panel left, right panel right on all steps
- Desktop: `Group orientation="horizontal"` with two Panel components
- Step 8: IdeationSubStepContainer handles its own layout (unchanged)
- Steps 1-7, 9-10: StepContainer renders ChatPanel left, RightPanel right

**LAYOUT-02:** Resizable divider between panels
- Separator component from react-resizable-panels with touch-friendly hit area (24px)
- Panel defaultSize={50}/minSize={30} (left) and defaultSize={50}/minSize={25} (right)

**LAYOUT-03:** Steps without canvas show placeholder right panel
- RightPanel renders placeholder with "Workspace" heading when no artifact/canvas
- When artifact extracted, OutputPanel replaces placeholder in right panel
- CANVAS_STEPS set ready for future steps (currently empty; step 8 uses separate container)

**LAYOUT-04:** Mobile (<768px) chat stacks above right panel vertically
- isMobile detection via window.innerWidth < 768 with resize listener
- Mobile layout: flexbox column with border-b separator between chat and right panel
</verification>

<success_criteria>
1. `npm run build` succeeds with zero errors
2. `npx tsc --noEmit` passes
3. `right-panel.tsx` exists and exports RightPanel component
4. `step-container.tsx` uses RightPanel (not inline renderOutput)
5. Desktop layout has resizable panels (Group/Panel/Separator)
6. Mobile layout has vertical stacking (no Group/Panel)
7. Step 8 early-returns to IdeationSubStepContainer (unchanged)
8. Placeholder shows for steps without canvas or artifact
9. OutputPanel shows in right panel when artifact exists
</success_criteria>

<output>
After completion, create `.planning/phases/16-split-screen-layout/16-01-SUMMARY.md`
</output>
