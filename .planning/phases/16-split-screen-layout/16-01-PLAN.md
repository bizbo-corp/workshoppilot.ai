---
phase: 16-split-screen-layout
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/workshop/step-container.tsx
  - src/components/workshop/right-panel.tsx
autonomous: true
user_setup: []

must_haves:
  truths:
    - "User sees chat panel left, right panel right on all steps (1-7, 9-10; step 8 unchanged)"
    - "User can resize the divider between chat and right panel"
    - "Right panel shows OutputPanel when artifact exists, placeholder when no artifact (for steps 1-7, 9-10)"
    - "Canvas is NOT rendered on steps 1-7, 9-10 (removed from current code which incorrectly renders it on all steps)"
    - "On mobile (<768px), chat stacks above right panel vertically"
  artifacts:
    - path: "src/components/workshop/right-panel.tsx"
      provides: "Dedicated right panel component with conditional output/placeholder rendering"
      exports: ["RightPanel"]
    - path: "src/components/workshop/step-container.tsx"
      provides: "Refactored layout using RightPanel instead of inline renderOutput"
      contains: "RightPanel"
  key_links:
    - from: "src/components/workshop/step-container.tsx"
      to: "src/components/workshop/right-panel.tsx"
      via: "import and render RightPanel inside right Panel (desktop) and below chat (mobile)"
      pattern: "import.*RightPanel.*right-panel"
    - from: "src/components/workshop/right-panel.tsx"
      to: "src/components/workshop/output-panel.tsx"
      via: "renders OutputPanel when artifact exists or isExtracting or extractionError"
      pattern: "OutputPanel"
    - from: "src/components/workshop/right-panel.tsx"
      to: "src/components/workshop/artifact-confirmation.tsx"
      via: "renders ArtifactConfirmation when artifact exists"
      pattern: "ArtifactConfirmation"
    - from: "src/components/workshop/step-container.tsx"
      to: "react-resizable-panels"
      via: "Group/Panel/Separator for desktop layout"
      pattern: "Group.*orientation.*horizontal"
---

<objective>
Refactor the step-container layout so the right panel is a dedicated component that conditionally shows output panel or placeholder content. Chat stays left, right panel content stays right, with resizable divider on desktop and vertical stacking on mobile.

Purpose: Implements LAYOUT-01 through LAYOUT-04 requirements. Currently the `renderOutput()` function in step-container.tsx renders CanvasWrapper for ALL non-step-8 steps (lines 239-277), even though only step 8 actually uses canvas meaningfully (via IdeationSubStepContainer). This refactoring: (1) extracts right panel into its own component, (2) removes the incorrect CanvasWrapper rendering from non-canvas steps, and (3) replaces it with a clean placeholder or OutputPanel based on artifact state.

Output: `right-panel.tsx` (new), refactored `step-container.tsx`
</objective>

<execution_context>
@/Users/michaelchristie/.claude/get-shit-done/workflows/execute-plan.md
@/Users/michaelchristie/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/16-split-screen-layout/16-RESEARCH.md
@src/components/workshop/step-container.tsx
@src/components/workshop/output-panel.tsx
@src/components/workshop/chat-panel.tsx
@src/components/canvas/canvas-wrapper.tsx
@src/components/workshop/ideation-sub-step-container.tsx
@src/components/workshop/step-navigation.tsx
@src/components/workshop/artifact-confirmation.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create RightPanel component and refactor step-container layout</name>
  <files>
    src/components/workshop/right-panel.tsx
    src/components/workshop/step-container.tsx
  </files>
  <action>
**IMPORTANT -- Current codebase state you will see when reading the files:**

In `step-container.tsx`, the `renderOutput()` function (lines 239-277) currently renders CanvasWrapper for ALL non-step-8 steps. The full structure is:
```
renderOutput() {
  return (
    <div className="flex h-full flex-col">
      {/* Canvas - rendered for ALL steps (this is wrong/unintended) */}
      <div className="min-h-[300px] flex-1 border-b">
        <CanvasWrapper sessionId={...} stepId={...} workshopId={...} />
      </div>
      {/* OutputPanel - below canvas */}
      <div className="flex-1 overflow-hidden">
        <OutputPanel ... />
      </div>
      {/* ArtifactConfirmation - when artifact exists */}
      {artifact && <ArtifactConfirmation ... />}
    </div>
  );
}
```

This phase REMOVES CanvasWrapper from non-canvas steps. Only step 8 uses canvas, and step 8 already has its own dedicated `IdeationSubStepContainer` (early return on line 187). The CanvasWrapper in renderOutput() was added prematurely and should not render on steps 1-7, 9-10.

---

**Create `src/components/workshop/right-panel.tsx`:**

Props interface:
```typescript
interface RightPanelProps {
  stepOrder: number;
  sessionId: string;
  workshopId: string;
  artifact: Record<string, unknown> | null;
  isExtracting: boolean;
  extractionError: string | null;
  onRetry?: () => void;
  artifactConfirmed: boolean;
  onConfirm: () => void;
  onEdit: () => void;
}
```

Rendering logic (priority order -- NO CanvasWrapper on these steps):
1. **If artifact exists OR isExtracting OR extractionError**: Render a `<div className="flex h-full flex-col">` containing:
   - `<div className="flex-1 overflow-hidden"><OutputPanel>` with the existing artifact/extraction props
   - When artifact exists, also render `<div className="border-t bg-background p-4"><ArtifactConfirmation>` below it
2. **Default (no artifact, no extraction in progress)**: Render placeholder with centered content:
   - A subtle icon (use `PanelRight` from lucide-react, not an emoji)
   - Heading: "Workspace"
   - Subtext: "AI-generated outputs will appear here as you progress through the conversation."
   - Use `text-muted-foreground` styling, `flex items-center justify-center h-full`

The component should be `'use client'` and import OutputPanel, ArtifactConfirmation from their existing locations. Do NOT import CanvasWrapper -- it is intentionally excluded from this component because steps 1-7 and 9-10 do not use canvas.

---

**Refactor `step-container.tsx`:**

1. **Delete the entire `renderOutput()` function** (lines 239-277). This removes the CanvasWrapper that was incorrectly rendering on all steps.
2. **Remove these imports** (they move to right-panel.tsx or are no longer needed here):
   - `CanvasWrapper` from `@/components/canvas/canvas-wrapper` (line 18)
   - `ArtifactConfirmation` from `./artifact-confirmation` (line 9)
   - `OutputPanel` from `./output-panel` (line 8)
3. **Add import:** `import { RightPanel } from './right-panel';`
4. **In the desktop layout (lines 306-343):** Replace `{renderOutput()}` in the right Panel with:
   ```tsx
   <RightPanel
     stepOrder={stepOrder}
     sessionId={sessionId}
     workshopId={workshopId}
     artifact={artifact}
     isExtracting={isExtracting}
     extractionError={extractionError}
     onRetry={extractArtifact}
     artifactConfirmed={artifactConfirmed}
     onConfirm={handleConfirm}
     onEdit={handleEdit}
   />
   ```
5. **In the mobile layout (lines 280-303):** Replace `{renderOutput()}` with the same `<RightPanel>` component (same props).
6. **Keep unchanged:** `renderContent()` function (chat panel with extract button), step 8 early return to IdeationSubStepContainer, isMobile detection, Group/Panel/Separator, StepNavigation, ResetStepDialog, panel sizing (left `defaultSize={50} minSize={30}`, right `defaultSize={50} minSize={25}`), Separator with touch-friendly hit area.
  </action>
  <verify>
Run `npx tsc --noEmit` -- no TypeScript errors. Run `npm run build` -- build succeeds. Verify `right-panel.tsx` exists and exports `RightPanel`. Verify `step-container.tsx` imports `RightPanel` and no longer imports `CanvasWrapper`, `ArtifactConfirmation`, or `OutputPanel`.
  </verify>
  <done>
Desktop: chat panel left with extract button, right panel shows placeholder (no artifact) or OutputPanel+ArtifactConfirmation (with artifact) for steps 1-7 and 9-10. CanvasWrapper no longer renders on these steps (removed from the old renderOutput). Step 8 unchanged (uses IdeationSubStepContainer which manages its own canvas). Mobile: chat stacks above right panel vertically. Resizable divider works between panels on desktop. TypeScript compiles and Next.js builds successfully.
  </done>
</task>

<task type="auto">
  <name>Task 2: Verify responsive layout and panel behavior across viewports</name>
  <files>
    src/components/workshop/step-container.tsx
    src/components/workshop/right-panel.tsx
  </files>
  <action>
Run the dev server (`npm run dev`) and verify the layout works correctly. Then make any necessary CSS/layout fixes discovered during verification.

**Verification steps (automated via build + grep checks):**

1. Verify the desktop layout structure:
   - `step-container.tsx` uses `Group orientation="horizontal"` with two `Panel` components and a `Separator` between them
   - Left panel renders `renderContent()` (ChatPanel + extract button)
   - Right panel renders `<RightPanel>`

2. Verify the mobile layout structure:
   - `isMobile` state triggers vertical stacking
   - Chat panel div has `border-b` class for visual separation
   - Right panel renders below chat
   - No `Group`/`Panel`/`Separator` in mobile path (plain flexbox)

3. Verify `right-panel.tsx` handles both states correctly:
   - Grep for `OutputPanel` (artifact/extraction state)
   - Grep for `Workspace` or placeholder text (default state)
   - Grep for `ArtifactConfirmation` (confirmation UI when artifact exists)
   - Confirm `CanvasWrapper` does NOT appear in right-panel.tsx (intentional removal)

4. Verify CanvasWrapper removal from step-container:
   - Grep step-container.tsx for `CanvasWrapper` -- should NOT be found (import removed)
   - Grep step-container.tsx for `canvas-wrapper` -- should NOT be found (import path removed)
   - Grep step-container.tsx for `renderOutput` -- should NOT be found (function deleted)

5. Verify no regression in step 8:
   - Grep for `stepOrder === 8` in step-container.tsx (early return to IdeationSubStepContainer)
   - Confirm IdeationSubStepContainer import still present

6. Final build check:
   - Run `npm run build` to confirm production build succeeds with no errors
   - This catches SSR issues, missing imports, type errors

If any layout issues are found during these checks, fix them in the same task. Common issues to watch for:
- Right panel not taking full height (needs `h-full` on RightPanel root div)
- Output panel overflow (needs `overflow-y-auto` on scrollable content)
- Placeholder not centering (needs `flex items-center justify-center h-full`)
  </action>
  <verify>
`npm run build` passes. Grep confirms: `Group orientation="horizontal"` in desktop path, `isMobile` conditional rendering, `OutputPanel` rendered conditionally in right-panel.tsx, placeholder "Workspace" text present in right-panel.tsx, `ArtifactConfirmation` in right-panel.tsx, `stepOrder === 8` early return in step-container.tsx. Grep confirms `CanvasWrapper` does NOT appear in step-container.tsx or right-panel.tsx.
  </verify>
  <done>
Split-screen layout verified: chat left, right panel right on desktop with resizable divider. Mobile stacks vertically. Steps 1-7 and 9-10 show placeholder (or OutputPanel when artifact extracted) with no canvas rendering. Step 8 unchanged (IdeationSubStepContainer with its own canvas). Production build succeeds.
  </done>
</task>

</tasks>

<verification>
**LAYOUT-01:** Chat panel left, right panel right on all steps
- Desktop: `Group orientation="horizontal"` with two Panel components
- Step 8: IdeationSubStepContainer handles its own layout (unchanged)
- Steps 1-7, 9-10: StepContainer renders ChatPanel left, RightPanel right

**LAYOUT-02:** Resizable divider between panels
- Separator component from react-resizable-panels with touch-friendly hit area (24px)
- Panel defaultSize={50}/minSize={30} (left) and defaultSize={50}/minSize={25} (right)

**LAYOUT-03:** Steps without canvas show appropriate right panel content
- RightPanel renders placeholder with "Workspace" heading when no artifact
- When artifact extracted, OutputPanel + ArtifactConfirmation replace placeholder in right panel
- CanvasWrapper intentionally NOT rendered on steps 1-7, 9-10 (removed from the old renderOutput that incorrectly showed it on all steps)
- Step 8 canvas is handled by IdeationSubStepContainer (separate early-return path, unchanged)

**LAYOUT-04:** Mobile (<768px) chat stacks above right panel vertically
- isMobile detection via window.innerWidth < 768 with resize listener
- Mobile layout: flexbox column with border-b separator between chat and right panel
</verification>

<success_criteria>
1. `npm run build` succeeds with zero errors
2. `npx tsc --noEmit` passes
3. `right-panel.tsx` exists and exports RightPanel component
4. `step-container.tsx` uses RightPanel (not inline renderOutput)
5. `step-container.tsx` does NOT import CanvasWrapper (removed)
6. `right-panel.tsx` does NOT import CanvasWrapper (intentionally excluded)
7. Desktop layout has resizable panels (Group/Panel/Separator)
8. Mobile layout has vertical stacking (no Group/Panel)
9. Step 8 early-returns to IdeationSubStepContainer (unchanged)
10. Placeholder shows for steps without artifact
11. OutputPanel + ArtifactConfirmation shows in right panel when artifact exists
</success_criteria>

<output>
After completion, create `.planning/phases/16-split-screen-layout/16-01-SUMMARY.md`
</output>
