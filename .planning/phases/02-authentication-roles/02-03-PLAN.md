---
phase: 02-authentication-roles
plan: 03
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - src/components/auth/sign-in-modal.tsx
  - src/components/auth/sign-up-modal.tsx
  - src/components/auth/auth-wall-modal.tsx
autonomous: true

must_haves:
  truths:
    - "User can sign in via a modal overlay using Clerk's SignIn component"
    - "User can sign up via a modal overlay using Clerk's SignUp component"
    - "Auth wall modal appears with sign-up form and preview of step 4"
    - "Auth wall modal can be dismissed and user stays on current page"
    - "Auth wall modal has 'Already have an account? Sign in' link"
  artifacts:
    - path: "src/components/auth/sign-in-modal.tsx"
      provides: "Modal wrapper for Clerk SignIn component"
      exports: ["SignInModal"]
      contains: "SignIn"
    - path: "src/components/auth/sign-up-modal.tsx"
      provides: "Modal wrapper for Clerk SignUp component"
      exports: ["SignUpModal"]
      contains: "SignUp"
    - path: "src/components/auth/auth-wall-modal.tsx"
      provides: "Auth wall modal with sign-up form and step 4 preview"
      exports: ["AuthWallModal"]
      contains: "Step 4"
  key_links:
    - from: "src/components/auth/sign-in-modal.tsx"
      to: "@clerk/nextjs"
      via: "SignIn component import"
      pattern: "import.*SignIn.*@clerk/nextjs"
    - from: "src/components/auth/auth-wall-modal.tsx"
      to: "@clerk/nextjs"
      via: "SignUp component import for auth wall"
      pattern: "import.*SignUp.*@clerk/nextjs"
---

<objective>
Create modal-based authentication UI components: sign-in modal, sign-up modal, and the auth wall modal that appears after step 3. Per user decision, auth appears as modal overlays on the current page, not dedicated routes. The auth wall shows a sign-up form alongside a preview of what's next.

Purpose: These components are the user-facing auth experience. They'll be mounted by page components (Plan 04) and the future workshop step pages (Phase 3).
Output: Three reusable auth modal components.
</objective>

<execution_context>
@/Users/michaelchristie/.claude/get-shit-done/workflows/execute-plan.md
@/Users/michaelchristie/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/02-authentication-roles/02-CONTEXT.md
@.planning/phases/02-authentication-roles/02-RESEARCH.md
@src/components/Logo.tsx
@src/lib/utils.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create sign-in and sign-up modal components</name>
  <files>src/components/auth/sign-in-modal.tsx, src/components/auth/sign-up-modal.tsx</files>
  <action>
    Create `src/components/auth/sign-in-modal.tsx`:

    1. Mark as 'use client' (uses Clerk client components and state).

    2. Import SignIn from '@clerk/nextjs', and Dialog/DialogContent/DialogOverlay from a simple custom implementation (do NOT rely on shadcn Dialog being installed — create the modal with native HTML dialog or a div overlay with fixed positioning and z-50).

    3. Props interface SignInModalProps:
       - open: boolean
       - onOpenChange: (open: boolean) => void
       - redirectUrl?: string (optional redirect after sign-in, defaults to '/dashboard')

    4. Render a modal overlay:
       - Fixed position, full screen, z-50, semi-transparent black backdrop
       - Centered content container with max-w-md, white background, rounded corners, shadow
       - Close button (X) in top-right corner that calls onOpenChange(false)
       - Clicking backdrop also closes modal
       - Prevent body scroll when modal is open

    5. Inside the modal content:
       - Render Clerk's `<SignIn />` component with:
         * `appearance={{ elements: { rootBox: 'w-full', card: 'shadow-none border-0' } }}`
         * `signUpUrl` prop pointing to handle switching to sign-up (or just '#' — the parent component handles switching)
         * `fallbackRedirectUrl={redirectUrl || '/dashboard'}`
       - Below the SignIn component, add text: "Don't have an account?" with a button/link that calls a provided `onSwitchToSignUp` callback prop

    6. Add onSwitchToSignUp?: () => void to props for modal switching.

    7. Only render when `open` is true. Use a portal or conditional rendering.

    ---

    Create `src/components/auth/sign-up-modal.tsx`:

    1. Mark as 'use client'.

    2. Same modal overlay pattern as sign-in-modal.

    3. Props interface SignUpModalProps:
       - open: boolean
       - onOpenChange: (open: boolean) => void
       - redirectUrl?: string (defaults to '/dashboard')
       - onSwitchToSignIn?: () => void

    4. Inside the modal content:
       - Render Clerk's `<SignUp />` component with:
         * `appearance={{ elements: { rootBox: 'w-full', card: 'shadow-none border-0' } }}`
         * `signInUrl` prop (or '#')
         * `fallbackRedirectUrl={redirectUrl || '/dashboard'}`
       - Per user decision: Clerk handles first name, last name collection natively (configured in Clerk Dashboard as required fields)
       - Per user decision: company/org field is optional and captured via Clerk's unsafeMetadata. This requires custom sign-up fields configured in Clerk Dashboard OR a custom sign-up form. For MVP 0.5, use Clerk's built-in SignUp component and configure name fields in Clerk Dashboard. Company field will be added as a custom field in unsafeMetadata via Clerk Dashboard custom configuration, or deferred to a post-sign-up profile completion step. Add a TODO comment noting this.
       - Below SignUp, add "Already have an account? Sign in" link (per user decision) that calls onSwitchToSignIn

    5. Only render when `open` is true.

    Both modals should share the same visual styling: consistent padding, max-width, backdrop opacity, and close button positioning. Extract shared modal wrapper styles into a common pattern within each file (or a small shared utility — but keep it simple, no new file needed for just CSS classes).
  </action>
  <verify>
    - `npm run build` passes without TypeScript errors
    - Both files export their respective components
    - Both components accept open, onOpenChange, and switch callback props
    - Clerk SignIn and SignUp components are properly imported
  </verify>
  <done>SignInModal and SignUpModal components render Clerk auth forms in modal overlays with close buttons, backdrop click-to-close, and links to switch between sign-in/sign-up.</done>
</task>

<task type="auto">
  <name>Task 2: Create auth wall modal component</name>
  <files>src/components/auth/auth-wall-modal.tsx</files>
  <action>
    Create `src/components/auth/auth-wall-modal.tsx`:

    1. Mark as 'use client'.

    2. Props interface AuthWallModalProps:
       - open: boolean
       - onOpenChange: (open: boolean) => void
       - onSwitchToSignIn?: () => void
       - workshopId?: string (for future use when workshops exist)

    3. Per user decision, the auth wall modal has specific requirements:
       - Shows sign-up form + preview of what's next ("Step 4: Prototype your idea")
       - Primary CTA is sign-up
       - "Already have an account? Sign in" link
       - Dismissable: if user closes, they stay on step 3, modal reappears on next advance attempt
       - After sign-up, user continues directly to step 4 (no intermediate dashboard)

    4. Modal layout (two-column on md+ screens, stacked on mobile):
       - LEFT COLUMN (or top on mobile): "What's next" preview
         * Heading: "Create your account to continue"
         * Subtext: "You've completed the first 3 steps! Sign up to unlock the rest of your design thinking journey."
         * Preview card for Step 4: Prototype
           - Step number badge (4)
           - Title: "Prototype"
           - Description: "Create low-fidelity representations of your solutions to test with users."
         * Brief list of remaining steps (5-10) as compact items:
           - 5: Test, 6: Define MVP, 7: Technical Spec, 8: User Stories, 9: Architecture, 10: Build Pack
         * Style: muted background, rounded border, professional but motivating

       - RIGHT COLUMN (or bottom on mobile): Clerk SignUp form
         * Render `<SignUp />` from @clerk/nextjs
         * appearance: shadow-none, no border on card, full width
         * fallbackRedirectUrl: '/dashboard' (Note: the actual redirect to step 4 will be handled by the component that mounts this modal in Phase 3, passing the correct workshop URL. For now, default to dashboard.)
         * Below: "Already have an account? Sign in" link calling onSwitchToSignIn

    5. Modal wrapper:
       - Fixed position, z-50, backdrop with semi-transparent black
       - Max-width: max-w-4xl (wider than sign-in/sign-up modals to accommodate two columns)
       - Close button (X) in top-right — this is the "dismiss" action per user decision
       - Clicking backdrop does NOT close (per user decision implication: explicit dismiss via close button or "Not now" button)
       - Add a subtle "Not now" text button at bottom-left for explicit dismissal

    6. Responsive: On screens < md, stack columns vertically (preview on top, sign-up below).

    7. Styling (Claude's discretion): Use Tailwind classes consistent with the app's design token system. Muted backgrounds for preview section, clean white for sign-up section. Professional spacing and typography.
  </action>
  <verify>
    - `npm run build` passes without TypeScript errors
    - Component exports AuthWallModal
    - Two-column layout visible in rendered HTML structure
    - Step 4 preview content present ("Prototype")
    - "Already have an account? Sign in" text present
    - Close button and "Not now" button present
  </verify>
  <done>AuthWallModal shows two-column layout with step 4-10 preview and Clerk SignUp form. Dismissable via close button or "Not now". Includes sign-in switch link. Ready to be mounted by workshop step pages in Phase 3.</done>
</task>

</tasks>

<verification>
1. `npm run build` passes
2. Three auth component files exist in src/components/auth/
3. All three export named components (SignInModal, SignUpModal, AuthWallModal)
4. All three use Clerk's SignIn or SignUp components
5. AuthWallModal contains step preview content and two-column layout
6. All modals have close/dismiss functionality
</verification>

<success_criteria>
- SignInModal renders Clerk SignIn in modal overlay with close and switch-to-signup
- SignUpModal renders Clerk SignUp in modal overlay with close and switch-to-signin
- AuthWallModal shows step 4 preview + SignUp form in two-column layout
- AuthWallModal is dismissable (close button + "Not now" button)
- All modals are 'use client' components ready for mounting
- Per user decisions: modal overlay (not dedicated routes), embedded Clerk components, sign-in/sign-up switching
</success_criteria>

<output>
After completion, create `.planning/phases/02-authentication-roles/02-03-SUMMARY.md`
</output>
