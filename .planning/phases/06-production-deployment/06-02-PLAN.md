---
phase: 06-production-deployment
plan: 02
type: execute
wave: 2
depends_on: ["06-01"]
files_modified: []
autonomous: false
user_setup:
  - service: vercel
    why: "Production deployment platform"
    env_vars:
      - name: NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY
        source: "Clerk Dashboard → API Keys → Production → Publishable key (pk_live_...)"
      - name: CLERK_SECRET_KEY
        source: "Clerk Dashboard → API Keys → Production → Secret key (sk_live_...)"
      - name: CLERK_WEBHOOK_SECRET
        source: "Clerk Dashboard → Webhooks → Production endpoint → Signing Secret (whsec_...)"
      - name: DATABASE_URL
        source: "Neon Dashboard → Connection Details → Connection string (pooled)"
      - name: DATABASE_URL_UNPOOLED
        source: "Neon Dashboard → Connection Details → Connection string (unpooled/direct)"
      - name: GOOGLE_GENERATIVE_AI_API_KEY
        source: "Google AI Studio → API Keys"
      - name: ADMIN_EMAIL
        source: "Your admin email address"
    dashboard_config:
      - task: "Create Clerk production instance (if not exists)"
        location: "Clerk Dashboard → Create application → Production"
      - task: "Add production domain to Clerk allowed origins"
        location: "Clerk Dashboard → Production → Domains → Add domain: workshoppilot.ai"
      - task: "Create production webhook endpoint in Clerk"
        location: "Clerk Dashboard → Webhooks → Add Endpoint → URL: https://workshoppilot.ai/api/webhooks/clerk → Events: user.created, user.updated, user.deleted"
  - service: domain-registrar
    why: "Custom domain DNS configuration"
    dashboard_config:
      - task: "Configure DNS A record for workshoppilot.ai"
        location: "Domain registrar DNS settings → Add A record: @ → 76.76.21.21"
      - task: "Configure DNS CNAME for www.workshoppilot.ai"
        location: "Domain registrar DNS settings → Add CNAME: www → cname.vercel-dns.com"

must_haves:
  truths:
    - "Application deploys successfully from main branch to Vercel"
    - "All features work in production: auth, database, AI chat streaming"
    - "Application is accessible at workshoppilot.ai with HTTPS"
    - "Clerk authentication works with production keys on custom domain"
    - "No console errors or broken functionality visible to end users"
  artifacts: []
  key_links:
    - from: "Vercel project settings"
      to: "Production environment"
      via: "Environment variables"
      pattern: "pk_live_.*"
    - from: "workshoppilot.ai DNS"
      to: "Vercel edge network"
      via: "A record pointing to 76.76.21.21"
      pattern: "76.76.21.21"
---

<objective>
Deploy the application to Vercel production, configure all environment variables with production keys, set up the custom domain, and verify everything works end-to-end.

Purpose: This is the final phase — getting the working application live at workshoppilot.ai with all services (Clerk auth, Neon database, Gemini AI) connected in production.

Output: Live application at https://workshoppilot.ai with working authentication, database persistence, and AI chat.
</objective>

<execution_context>
@/Users/michaelchristie/.claude/get-shit-done/workflows/execute-plan.md
@/Users/michaelchristie/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-production-deployment/06-RESEARCH.md
@.planning/phases/06-production-deployment/06-01-SUMMARY.md
</context>

<tasks>

<task type="checkpoint:human-action" gate="blocking">
  <name>Task 1: Configure Vercel production environment variables</name>
  <action>
    The user must configure production environment variables in the Vercel dashboard. These are secrets that Claude cannot access or create.
  </action>
  <instructions>
    **Go to:** https://vercel.com/team/workshoppilot → workshoppilot-ai → Settings → Environment Variables

    **Add the following variables (scope: Production only):**

    1. **NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY** — From Clerk Dashboard → API Keys → Production instance
       - Must start with `pk_live_` (NOT `pk_test_`)

    2. **CLERK_SECRET_KEY** — From Clerk Dashboard → API Keys → Production instance
       - Must start with `sk_live_` (NOT `sk_test_`)

    3. **CLERK_WEBHOOK_SECRET** — From Clerk Dashboard → Webhooks → Production endpoint signing secret
       - Must start with `whsec_`
       - Create webhook endpoint first: URL = `https://workshoppilot.ai/api/webhooks/clerk`
       - Events: user.created, user.updated, user.deleted

    4. **DATABASE_URL** — From Neon Dashboard → Connection Details → Pooled connection string
       - Can use same Neon database as development, or create production branch

    5. **DATABASE_URL_UNPOOLED** — From Neon Dashboard → Connection Details → Direct (unpooled) connection string
       - Same database, but direct connection for migrations

    6. **GOOGLE_GENERATIVE_AI_API_KEY** — From Google AI Studio → API Keys
       - Can use same key as development for MVP

    7. **ADMIN_EMAIL** — Your admin email address (same as development)

    **Also in Clerk Dashboard:**
    - Ensure production instance exists (not just development)
    - Add `workshoppilot.ai` to allowed domains/origins

    **Verify:** All 7 environment variables appear in Vercel project settings, scoped to Production.
  </instructions>
  <resume-signal>Type "configured" when all environment variables are set in Vercel, or describe any issues</resume-signal>
</task>

<task type="auto">
  <name>Task 2: Deploy to Vercel production and verify build</name>
  <files></files>
  <action>
    1. Ensure all code changes from Plan 06-01 are committed and pushed to main branch

    2. Trigger a production deployment using Vercel CLI:
       ```
       vercel --prod
       ```
       OR if auto-deploy on push is enabled, just push to main and monitor.

    3. Monitor the build output for:
       - verify-env.ts passes (all env vars present, production keys detected)
       - drizzle-kit migrate succeeds (database schema applied)
       - next build succeeds (no TypeScript or build errors)

    4. If build fails:
       - Check Vercel build logs for specific error
       - If env var missing: user needs to add it (back to Task 1)
       - If migration fails: check DATABASE_URL_UNPOOLED is correct
       - If build error: fix code and push again

    5. Once deployed, note the production URL (should be on *.vercel.app initially, then workshoppilot.ai after domain setup)
  </action>
  <verify>
    - Vercel dashboard shows successful production deployment
    - Build logs show: "All environment variables verified", successful migration, successful build
    - Production URL is accessible (may be *.vercel.app at this point)
  </verify>
  <done>
    - Application deployed to Vercel production
    - Build pipeline (verify-env → migrate → build) completed successfully
    - Production URL accessible and serving the application
  </done>
</task>

<task type="checkpoint:human-action" gate="blocking">
  <name>Task 3: Configure custom domain DNS and Clerk production domain</name>
  <action>
    The user must configure DNS records at their domain registrar and add the domain in Vercel and Clerk dashboards.
  </action>
  <instructions>
    **Step 1: Add domain in Vercel**
    - Go to: Vercel project → Settings → Domains
    - Add domain: `workshoppilot.ai`
    - When prompted, also add `www.workshoppilot.ai`
    - Vercel will show required DNS records

    **Step 2: Configure DNS at your domain registrar**
    - Add A record: `@` → `76.76.21.21` (Vercel's IP)
    - Add CNAME record: `www` → `cname.vercel-dns.com`
    - TTL: 3600 (or lowest available)

    **Step 3: Wait for DNS propagation**
    - Typically 15-30 minutes, can take up to 48 hours
    - Check with: `dig workshoppilot.ai` (should show 76.76.21.21)
    - Vercel will auto-issue SSL certificate once DNS propagates

    **Step 4: Add domain to Clerk production**
    - Go to: Clerk Dashboard → Production instance → Domains
    - Add: `workshoppilot.ai`
    - This is REQUIRED for production Clerk keys to work with custom domain

    **Verify:**
    - https://workshoppilot.ai loads the application
    - Green padlock (HTTPS) visible in browser
    - Clerk authentication works (sign-in/sign-up modals appear)
  </instructions>
  <resume-signal>Type "domain configured" when DNS is set up and workshoppilot.ai is accessible, or describe any issues</resume-signal>
</task>

</tasks>

<verification>
1. Visit https://workshoppilot.ai — application loads with landing page
2. Click "Start Workshop" — creates session and navigates to step 1
3. Navigate through steps 1-3 (public steps work without auth)
4. Attempt step 4 — auth wall appears (Clerk production working)
5. Sign up with new account — Clerk sign-up modal works
6. After sign-up, continue to step 4 — access granted
7. Type message in AI chat — Gemini responds with streaming
8. Navigate between steps — chat history persists
9. Visit /dashboard — shows workshop with management CTAs
10. Check browser console — no errors
11. Check Vercel dashboard — deployment healthy, no function errors
</verification>

<success_criteria>
- Application live at https://workshoppilot.ai with HTTPS
- Authentication flow works end-to-end with production Clerk keys
- Database queries succeed (workshop creation, step state, chat messages)
- AI chat streams responses from Gemini API
- No console errors or broken functionality
- Vercel Analytics and Speed Insights collecting data
</success_criteria>

<output>
After completion, create `.planning/phases/06-production-deployment/06-02-SUMMARY.md`
</output>
