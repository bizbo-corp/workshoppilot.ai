---
phase: 44-ai-deliverable-generation
plan: "02"
type: execute
wave: 2
depends_on: ["44-01"]
files_modified:
  - src/components/workshop/synthesis-summary-view.tsx
  - src/components/workshop/deliverable-card.tsx
  - src/components/workshop/step-container.tsx
autonomous: true
requirements: [GEN-01, GEN-02, GEN-03, GEN-04]

must_haves:
  truths:
    - "User clicks PRD deliverable card and it triggers generation via API, showing loading state"
    - "User clicks Tech Specs deliverable card and it triggers generation via API, showing loading state"
    - "After generation completes, the card shows a success state with 'View on Outputs Page' label"
    - "Generation errors show a toast notification without crashing the UI"
  artifacts:
    - path: "src/components/workshop/synthesis-summary-view.tsx"
      provides: "PRD and Tech Specs cards wired to generation API calls"
      contains: "generate-tech-specs"
    - path: "src/components/workshop/deliverable-card.tsx"
      provides: "DeliverableCard with loading and generated states"
      contains: "isLoading"
    - path: "src/components/workshop/step-container.tsx"
      provides: "Generation callbacks passed to synthesis views"
      contains: "handleGeneratePrd"
  key_links:
    - from: "src/components/workshop/synthesis-summary-view.tsx"
      to: "/api/build-pack/generate-prd"
      via: "fetch call in generation handler"
      pattern: "generate-prd.*full-prd"
    - from: "src/components/workshop/synthesis-summary-view.tsx"
      to: "/api/build-pack/generate-tech-specs"
      via: "fetch call in generation handler"
      pattern: "generate-tech-specs"
    - from: "src/components/workshop/step-container.tsx"
      to: "src/components/workshop/synthesis-summary-view.tsx"
      via: "onGenerateFullPrd and onGenerateTechSpecs props"
      pattern: "onGenerateFullPrd|onGenerateTechSpecs"
---

<objective>
Wire the PRD and Tech Specs deliverable cards to the generation API routes, with loading states, success indicators, and error handling via toast notifications.

Purpose: Without this wiring, the generation API routes built in Plan 01 are unreachable from the UI. Users need to click a card, see generation progress, and know when their deliverables are ready.

Output: Functional deliverable cards that trigger AI generation and provide clear feedback throughout the process.
</objective>

<execution_context>
@/Users/michaelchristie/.claude/get-shit-done/workflows/execute-plan.md
@/Users/michaelchristie/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/44-ai-deliverable-generation/44-01-SUMMARY.md

Key source files:
@src/components/workshop/synthesis-summary-view.tsx
@src/components/workshop/deliverable-card.tsx
@src/components/workshop/step-container.tsx
@src/components/workshop/step-navigation.tsx
@src/app/workshop/[sessionId]/step/[stepId]/page.tsx
@src/app/workshop/[sessionId]/results/results-content.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Wire deliverable cards to generation APIs with loading and success states</name>
  <files>
    src/components/workshop/synthesis-summary-view.tsx
    src/components/workshop/step-container.tsx
    src/components/workshop/deliverable-card.tsx
    src/app/workshop/[sessionId]/results/results-content.tsx
  </files>
  <action>
**1. Update `SynthesisSummaryView` and `SynthesisBuildPackSection` to manage generation state:**

Add local React state for tracking generation status of each deliverable:
```typescript
const [prdStatus, setPrdStatus] = React.useState<'idle' | 'loading' | 'done' | 'error'>('idle');
const [techSpecsStatus, setTechSpecsStatus] = React.useState<'idle' | 'loading' | 'done' | 'error'>('idle');
```

Add generation handler functions inside each component (or accept them as props — use the prop approach for consistency with existing `onGeneratePrd` pattern):

Add new props to both `SynthesisSummaryView` and `SynthesisBuildPackSection`:
```typescript
onGenerateFullPrd?: () => Promise<void>;
onGenerateTechSpecs?: () => Promise<void>;
prdGenerated?: boolean;    // true if PRD already exists in DB
techSpecsGenerated?: boolean; // true if Tech Specs already exists in DB
```

Update the PRD card rendering (the `DELIVERABLES.filter(d => d.id === 'prd')` section):
- When `workshopCompleted` is true:
  - If `prdStatus === 'loading'`: show `isLoading={true}` on the DeliverableCard
  - If `prdStatus === 'done'` or `prdGenerated === true`: show `buttonLabel="View on Outputs Page"` with `disabled={true}` (Phase 45 will wire the actual navigation)
  - If `prdStatus === 'error'`: show `buttonLabel="Retry Generation"` with `disabled={false}`
  - Otherwise (idle, not yet generated): show `buttonLabel="Generate PRD"` with `disabled={false}`, `onDownload={handleGeneratePrd}`
- When not completed: keep existing `disabled={true}`, `buttonLabel="Coming Soon"`

Same pattern for Tech Specs card.

Wire the `handleGeneratePrd` to call the prop `onGenerateFullPrd`, wrapped in try/catch with `setPrdStatus('loading')` / `setPrdStatus('done')` / `setPrdStatus('error')`. Same for Tech Specs.

**2. Update `step-container.tsx` to provide generation callbacks:**

Add generation handler functions in `StepContainer`:

```typescript
const handleGenerateFullPrd = React.useCallback(async () => {
  if (!session?.workshop?.id) return;
  const res = await fetch('/api/build-pack/generate-prd', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ workshopId: session.workshop.id, type: 'full-prd' }),
  });
  if (!res.ok) {
    const err = await res.json().catch(() => ({ error: 'Generation failed' }));
    throw new Error(err.error || 'Failed to generate PRD');
  }
  toast.success('PRD generated successfully');
}, [session?.workshop?.id]);

const handleGenerateTechSpecs = React.useCallback(async () => {
  if (!session?.workshop?.id) return;
  const res = await fetch('/api/build-pack/generate-tech-specs', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ workshopId: session.workshop.id }),
  });
  if (!res.ok) {
    const err = await res.json().catch(() => ({ error: 'Generation failed' }));
    throw new Error(err.error || 'Failed to generate Tech Specs');
  }
  toast.success('Tech Specs generated successfully');
}, [session?.workshop?.id]);
```

Pass these callbacks to `SynthesisSummaryView` and `SynthesisBuildPackSection` wherever they're rendered. Also pass to the results-content.tsx render path.

**3. Update `results-content.tsx`:**

The results page renders `SynthesisSummaryView` and `SynthesisBuildPackSection` with `workshopCompleted={true}`. Add the generation callback props here as well. Since results-content is a client component, it can make fetch calls directly. Add the same generation handler pattern inline or extract into a shared hook.

**4. Toast integration:**

Use the existing sonner toast pattern (already imported in step-container.tsx from prior work). On generation success: `toast.success('PRD generated successfully')` / `toast.success('Tech Specs generated successfully')`. On error: `toast.error('Failed to generate PRD. Please try again.')`.

**5. Update `deliverable-card.tsx`:**

The existing component already supports `isLoading` and `buttonLabel` props — no structural changes needed. Just verify the loading spinner renders correctly when `isLoading={true}`.

**6. Remove 'Coming in Phase 44' labels:**

Replace all instances of `'Coming in Phase 44'` with the dynamic labels described above. After this plan, the cards should show:
- "Generate PRD" / "Generate Tech Specs" when workshop is completed but not yet generated
- Loading spinner during generation
- "View on Outputs Page" after generation (disabled until Phase 45 adds the route)
- "Retry Generation" on error
- "Coming Soon" when workshop is not completed
  </action>
  <verify>
- `npx tsc --noEmit` passes
- No remaining 'Coming in Phase 44' strings in the codebase (grep confirms)
- `npm run build` succeeds
- DeliverableCard renders loading state when `isLoading={true}` (verify in JSX structure)
  </verify>
  <done>
- PRD and Tech Specs cards show "Generate PRD" / "Generate Tech Specs" buttons on completed workshops
- Clicking a generate button calls the correct API route and shows a loading spinner
- On success, the card transitions to "View on Outputs Page" and a toast confirms generation
- On error, the card shows "Retry Generation" and a toast explains the failure
- 'Coming in Phase 44' placeholder labels are fully replaced
- Results page also supports generation (not just Step 10 view)
  </done>
</task>

</tasks>

<verification>
1. TypeScript compilation: `npx tsc --noEmit` passes
2. No remaining 'Coming in Phase 44' strings: `grep -r 'Coming in Phase 44' src/` returns empty
3. Build: `npm run build` succeeds
4. PRD card disabled state: when `workshopCompleted=false`, card shows "Coming Soon" and button is disabled
5. PRD card active state: when `workshopCompleted=true`, card shows "Generate PRD" with clickable button
</verification>

<success_criteria>
- Deliverable cards are fully interactive on completed workshops
- Generation triggers visible loading state feedback
- Success and error cases both handled with toast notifications
- All 'Coming in Phase 44' placeholders replaced with real functionality
- Both Step 10 view and results page support generation
</success_criteria>

<output>
After completion, create `.planning/phases/44-ai-deliverable-generation/44-02-SUMMARY.md`
</output>
