---
phase: 28-mind-map-crazy-8s
plan: 06
type: execute
wave: 3
depends_on: ["28-03", "28-05"]
files_modified:
  - src/components/workshop/ideation-sub-step-container.tsx
  - src/components/workshop/idea-selection.tsx
  - src/lib/ai/prompts/step-prompts.ts
  - src/lib/ai/prompts/validation-criteria.ts
  - src/lib/schemas/step-schemas.ts
  - src/lib/workshop/step-metadata.ts
  - src/app/api/dev/seed-workshop/fixtures.ts
autonomous: true

must_haves:
  truths:
    - "Step 8 sub-step tabs show: Mind Mapping, Crazy 8s, Idea Selection (no Brain Writing)"
    - "Mind Mapping tab renders MindMapCanvas component"
    - "Crazy 8s tab renders Crazy8sCanvas component"
    - "Idea Selection tab shows filled Crazy 8s slots for user to select top ideas"
    - "User can check/uncheck Crazy 8s sketches to select top ideas for Step 9"
    - "No references to Brain Writing remain in Step 8 AI prompts or UI"
    - "Step 8 metadata description reflects new 3-part flow"
  artifacts:
    - path: "src/components/workshop/ideation-sub-step-container.tsx"
      provides: "Updated Step 8 container with Mind Map + Crazy 8s + Idea Selection"
      contains: "MindMapCanvas"
    - path: "src/components/workshop/idea-selection.tsx"
      provides: "Updated idea selection from Crazy 8s sketches"
      contains: "crazy8sSlots"
    - path: "src/lib/ai/prompts/step-prompts.ts"
      provides: "Updated Step 8 prompts without Brain Writing"
    - path: "src/lib/workshop/step-metadata.ts"
      provides: "Updated Step 8 description"
      contains: "Mind Mapping"
  key_links:
    - from: "src/components/workshop/ideation-sub-step-container.tsx"
      to: "src/components/workshop/mind-map-canvas.tsx"
      via: "MindMapCanvas component in Mind Mapping tab"
      pattern: "MindMapCanvas"
    - from: "src/components/workshop/ideation-sub-step-container.tsx"
      to: "src/components/workshop/crazy-8s-canvas.tsx"
      via: "Crazy8sCanvas component in Crazy 8s tab"
      pattern: "Crazy8sCanvas"
    - from: "src/components/workshop/idea-selection.tsx"
      to: "src/stores/canvas-store.ts"
      via: "Read crazy8sSlots for selection UI"
      pattern: "crazy8sSlots"
---

<objective>
Update Step 8 flow to remove Brain Writing and integrate the new visual Mind Map and Crazy 8s canvases with Idea Selection from sketches.

Purpose: This is the final integration plan that transforms Step 8 from a text-only 3-tab (Mind Mapping + Crazy 8s + Brain Writing) flow into a visual-first 3-tab (Mind Mapping + Crazy 8s + Idea Selection) flow. Brain Writing is removed because it requires real multi-user collaboration. Idea Selection now sources from Crazy 8s sketches instead of text ideas.

Output: Updated Step 8 container, idea selection, AI prompts, step metadata, schemas, and fixtures.
</objective>

<execution_context>
@/Users/michaelchristie/.claude/get-shit-done/workflows/execute-plan.md
@/Users/michaelchristie/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/28-mind-map-crazy-8s/28-RESEARCH.md
@.planning/phases/28-mind-map-crazy-8s/28-03-SUMMARY.md
@.planning/phases/28-mind-map-crazy-8s/28-05-SUMMARY.md

# Files to modify
@src/components/workshop/ideation-sub-step-container.tsx
@src/components/workshop/idea-selection.tsx
@src/lib/ai/prompts/step-prompts.ts
@src/lib/ai/prompts/validation-criteria.ts
@src/lib/schemas/step-schemas.ts
@src/lib/workshop/step-metadata.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update ideation container and idea selection for new flow</name>
  <files>
    src/components/workshop/ideation-sub-step-container.tsx
    src/components/workshop/idea-selection.tsx
  </files>
  <action>
**ideation-sub-step-container.tsx — Major rewrite:**

Update the sub-step type and order:
```typescript
type IdeationSubStep = 'mind-mapping' | 'crazy-eights' | 'idea-selection';

const SUB_STEP_ORDER: IdeationSubStep[] = ['mind-mapping', 'crazy-eights', 'idea-selection'];
const SUB_STEP_LABELS: Record<IdeationSubStep, string> = {
  'mind-mapping': 'Mind Mapping',
  'crazy-eights': 'Crazy 8s',
  'idea-selection': 'Idea Selection',
};
```

Remove all Brain Writing references:
- Delete `brainWritingEngaged` state
- Delete Brain Writing tab trigger and content
- Delete `brain-writing` from type union
- Update progress header: replace '8c: Brain Writing' with '8c: Idea Selection'
- Remove brain-writing icon import (PenTool) — replace with CheckCircle2 or similar for Idea Selection

Update tab structure from chat+output layout to canvas layout for Mind Mapping and Crazy 8s:

**Mind Mapping tab (8a):**
Instead of the resizable chat+output panel, render:
```tsx
<TabsContent value="mind-mapping" ...>
  <div className="h-full flex flex-col">
    {/* Keep chat panel but smaller — 40% of height for AI guidance */}
    <div className="flex-1 min-h-0">
      <MindMapCanvas
        workshopId={workshopId}
        stepId={stepId}
        hmwStatement={hmwStatement}
      />
    </div>
  </div>
</TabsContent>
```

Where `stepId` is looked up from `getStepByOrder(8)?.id` and `hmwStatement` is extracted from earlier step artifacts (pass as prop or fetch).

Import MindMapCanvas from `@/components/workshop/mind-map-canvas`.

**Crazy 8s tab (8b):**
```tsx
<TabsContent value="crazy-eights" ...>
  <Crazy8sCanvas workshopId={workshopId} stepId={stepId} />
</TabsContent>
```

Import Crazy8sCanvas from `@/components/workshop/crazy-8s-canvas`.

**Idea Selection tab (8c):**
Keep chat+output panel for AI-guided idea selection, but update the IdeaSelection component to work with Crazy 8s slots:
```tsx
<TabsContent value="idea-selection" ...>
  {isMobile ? (/* mobile stacked */) : (
    <Group orientation="horizontal" className="h-full">
      <Panel defaultSize={40} minSize={30}>
        {renderChatPanel('idea-selection')}
      </Panel>
      <Separator .../>
      <Panel defaultSize={60} minSize={30}>
        <div className="h-full overflow-auto p-4">
          <IdeaSelection
            crazy8sSlots={crazy8sSlots}
            mindMapThemes={mindMapThemes}
            selectedSlotIds={selectedSlotIds}
            onSelectionChange={setSelectedSlotIds}
            maxSelection={4}
          />
          {artifact && (
            <ArtifactConfirmation onConfirm={handleConfirm} onEdit={handleEdit} isConfirming={false} isConfirmed={artifactConfirmed} />
          )}
        </div>
      </Panel>
    </Group>
  )}
</TabsContent>
```

Get `crazy8sSlots` from canvas store. Get `mindMapThemes` from store (mindMapNodes where level === 1).

Update `selectedIdeas` state to `selectedSlotIds: string[]` (slot IDs, not idea titles).

Update `handleConfirm` to merge selectedSlotIds into artifact instead of selectedIdeaTitles.

Remove the `allIdeasFromArtifact` useMemo that extracted Brain Writing ideas.

**idea-selection.tsx — Rework for Crazy 8s sketches:**

Change props from text-based ideas to visual sketches:
```typescript
interface IdeaSelectionProps {
  crazy8sSlots: Crazy8sSlot[];
  mindMapThemes?: MindMapNodeState[];  // Optional: level-1 theme nodes for context
  selectedSlotIds: string[];
  onSelectionChange: (slotIds: string[]) => void;
  maxSelection?: number;
}
```

Render each filled Crazy 8s slot as a selectable card:
- Grid layout: `grid grid-cols-2 md:grid-cols-4 gap-4`
- Each card shows:
  - Sketch thumbnail (`<img>` with the slot's imageUrl)
  - Slot title below image
  - Checkbox overlay in top-right corner
  - Selected state: blue border, checkmark visible
  - Empty slots (no imageUrl) are hidden or grayed out (can't select empty sketch)
- On click: toggle slotId in selectedSlotIds array
- Show count: "Selected {N}/{max}"

Add mind map themes section above (read-only context):
- If `mindMapThemes` provided, show them as small color-coded tags
- Label: "Themes from Mind Map" — gives context for which ideas to select
- This is informational only, not interactive

Remove all Brain Writing source references:
- Remove `brain-writing` from source type union
- Remove brainWritingIdeas filter and section
- Remove Brain Writing heading
  </action>
  <verify>
Run `npx tsc --noEmit` — zero errors.
Grep `src/components/workshop/ideation-sub-step-container.tsx` for: MindMapCanvas, Crazy8sCanvas, idea-selection. Verify NO matches for: brain-writing, brainWriting, Brain Writing, PenTool.
Grep `src/components/workshop/idea-selection.tsx` for: crazy8sSlots, selectedSlotIds. Verify NO matches for: brain-writing, brainWriting.
  </verify>
  <done>
Step 8 container has 3 tabs (Mind Mapping, Crazy 8s, Idea Selection). Mind Map and Crazy 8s render visual canvases. Idea Selection shows Crazy 8s sketches for selection. All Brain Writing references removed.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update AI prompts, schemas, metadata, and fixtures</name>
  <files>
    src/lib/ai/prompts/step-prompts.ts
    src/lib/ai/prompts/validation-criteria.ts
    src/lib/schemas/step-schemas.ts
    src/lib/workshop/step-metadata.ts
    src/app/api/dev/seed-workshop/fixtures.ts
  </files>
  <action>
**step-prompts.ts:**
1. Update `getIdeationSubStepInstructions` function:
   - Change parameter type from `'mind-mapping' | 'crazy-eights' | 'brain-writing'` to `'mind-mapping' | 'crazy-eights' | 'idea-selection'`
   - Remove the `'brain-writing'` case entirely
   - Add `'idea-selection'` case:
     ```
     STEP 8c: IDEA SELECTION — Help user select their best ideas from Crazy 8s sketches.

     The user has completed Mind Mapping (theme exploration) and Crazy 8s (8 rapid sketches).
     Now help them evaluate and select the top 2-4 ideas to develop further in Step 9.

     CONVERSATION FLOW:
     1. Ask user which sketches they feel strongest about
     2. Help them articulate WHY those ideas are compelling
     3. Encourage diversity (don't pick 4 similar ideas)
     4. Confirm final selection

     CRITERIA FOR SELECTION:
     - Feasibility: Can this realistically be built?
     - Desirability: Does the persona actually want this?
     - Novelty: Does this offer something new?
     - Alignment: Does this address the HMW statement?
     ```
2. Update the main 'ideation' step prompt:
   - Replace references to Brain Writing with Idea Selection
   - Update sub-step list: "8a: Mind Mapping, 8b: Crazy 8s, 8c: Idea Selection"
   - Remove "Yes, and..." technique references
   - Add reference to visual mind map and sketch-based ideation

**validation-criteria.ts:**
1. Remove 'Brain Writing Coherence' criterion
2. Update 'Sub-step Order' criterion: "Sub-steps executed in correct order: Mind Mapping (8a), Crazy 8s (8b), Idea Selection (8c)"
3. Update 'Idea Volume' criterion: remove "Brain Writing" reference, adjust to reflect visual ideation

**step-schemas.ts:**
1. In Step 8 schema:
   - Remove `brainWrittenIdeas` field entirely (the z.array with originalTitle, evolutionDescription, finalVersion, source: 'brain-writing')
   - Add `selectedSketchSlotIds` field: `z.array(z.string()).describe('Slot IDs of Crazy 8s sketches selected for Step 9')`
   - Add `mindMapThemes` field: `z.array(z.object({ theme: z.string(), color: z.string() })).describe('Theme branches from mind map')`
   - Keep `clusters` (now populated from mind map themes), keep `crazyEightsIdeas` (now backed by sketches)
   - Remove `source: z.literal('brain-writing')` from any source unions

**step-metadata.ts:**
Update Step 8 entry:
- `description`: Change from 'Generate ideas using Mind Mapping, Crazy 8s, Brain Writing, and Billboard Hero' to 'Generate ideas using Mind Mapping and Crazy 8s sketching, then select top ideas'
- `greeting`: Update to reference visual ideation: "Time to get creative! We'll use Mind Mapping to explore themes, then Crazy 8s to sketch 8 rapid ideas. Finally, you'll select your best concepts to develop further."

**fixtures.ts:**
Update Step 8 seed data:
- Remove brainWrittenIdeas array entries
- Remove 'brain-writing' source references
- Update step summary text to not reference Brain Writing
- Add selectedSketchSlotIds example: `['slot-1', 'slot-3', 'slot-5']`
- Add mindMapThemes example: `[{ theme: 'Smart Routine Engine', color: '#3b82f6' }, ...]`
- Keep crazyEightsIdeas but update descriptions to reference sketches

Also update `src/components/workshop/chat-panel.tsx` if it references brain-writing in the subStep type. Change the type union to match the new sub-steps.

Run a final grep for remaining Brain Writing references:
```bash
grep -r "brainWriting\|brain.writing\|brain-writing\|Brain Writing" src/ --include="*.ts" --include="*.tsx"
```
Fix any remaining references found.
  </action>
  <verify>
Run `npx tsc --noEmit` — zero errors.
Run `npm run build` — production build succeeds.
Run `grep -r "brainWriting\|brain.writing\|brain-writing\|Brain Writing" src/ --include="*.ts" --include="*.tsx"` — ZERO matches.
Grep `src/lib/workshop/step-metadata.ts` for Step 8: contains "Mind Mapping" and "Crazy 8s", does NOT contain "Brain Writing".
Grep `src/lib/ai/prompts/step-prompts.ts` for: idea-selection. Does NOT contain: brain-writing.
  </verify>
  <done>
All Brain Writing references removed from AI prompts, validation criteria, schemas, metadata, and fixtures. Step 8 flow is now Mind Mapping → Crazy 8s → Idea Selection. TypeScript and build pass with zero errors.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with zero errors
2. `npm run build` succeeds
3. Zero grep matches for "brainWriting", "brain-writing", "Brain Writing" in src/
4. Step 8 tabs: Mind Mapping, Crazy 8s, Idea Selection
5. Mind Mapping tab renders MindMapCanvas
6. Crazy 8s tab renders Crazy8sCanvas
7. Idea Selection shows Crazy 8s sketches with checkboxes
8. Step 8 metadata references new 3-part flow
9. AI prompts reference idea-selection instead of brain-writing
10. Schema has selectedSketchSlotIds, no brainWrittenIdeas
</verification>

<success_criteria>
- Step 8 is fully transformed: visual Mind Map + Crazy 8s sketches + Idea Selection
- Brain Writing completely removed from codebase (zero references)
- AI prompts guide users through visual ideation workflow
- Idea Selection works from Crazy 8s sketches (not text ideas)
- Users can select 2-4 top sketches to carry to Step 9
- All types, schemas, metadata, and fixtures consistent
</success_criteria>

<output>
After completion, create `.planning/phases/28-mind-map-crazy-8s/28-06-SUMMARY.md`
</output>
