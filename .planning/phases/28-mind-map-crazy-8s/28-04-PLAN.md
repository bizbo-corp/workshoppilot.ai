---
phase: 28-mind-map-crazy-8s
plan: 04
type: execute
wave: 1
depends_on: []
files_modified:
  - src/lib/canvas/crazy-8s-types.ts
  - src/components/workshop/crazy-8s-grid.tsx
  - src/stores/canvas-store.ts
autonomous: true

must_haves:
  truths:
    - "Crazy 8s grid displays 8 slots in a 2x4 layout (4 columns x 2 rows)"
    - "Empty slots show a pencil icon placeholder with 'Click to sketch' text"
    - "Filled slots display the sketch PNG image"
    - "Each slot has a number badge (1-8) in the top-left corner"
    - "Filled slots have an editable title overlay at the bottom"
    - "Crazy 8s slot state persists in canvas store"
  artifacts:
    - path: "src/lib/canvas/crazy-8s-types.ts"
      provides: "Type definitions for Crazy 8s slots"
      exports: ["Crazy8sSlot", "EMPTY_CRAZY_8S_SLOTS"]
    - path: "src/components/workshop/crazy-8s-grid.tsx"
      provides: "2x4 grid component for 8 sketch slots"
      exports: ["Crazy8sGrid"]
    - path: "src/stores/canvas-store.ts"
      provides: "Crazy 8s slot state and CRUD actions"
      contains: "crazy8sSlots"
  key_links:
    - from: "src/components/workshop/crazy-8s-grid.tsx"
      to: "src/lib/canvas/crazy-8s-types.ts"
      via: "Crazy8sSlot type import"
      pattern: "Crazy8sSlot"
    - from: "src/components/workshop/crazy-8s-grid.tsx"
      to: "src/stores/canvas-store.ts"
      via: "store selectors for slots"
      pattern: "useCanvasStore|crazy8sSlots"
---

<objective>
Build the Crazy 8s grid component with 8 sketch slots in a 2x4 layout for Step 8b rapid sketching.

Purpose: Crazy 8s is a design sprint technique where users sketch 8 different ideas quickly. Each slot is a canvas for one sketch. This plan creates the grid display and slot state management. EzyDraw integration (tap-to-draw) comes in Plan 28-05.

Output: Type definitions, grid component, and canvas store extensions for Crazy 8s slot state.
</objective>

<execution_context>
@/Users/michaelchristie/.claude/get-shit-done/workflows/execute-plan.md
@/Users/michaelchristie/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/28-mind-map-crazy-8s/28-RESEARCH.md

# Reference: grid patterns from Journey Map
@src/components/canvas/grid-overlay.tsx
# Reference: store patterns
@src/stores/canvas-store.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Crazy 8s types and extend canvas store</name>
  <files>
    src/lib/canvas/crazy-8s-types.ts
    src/stores/canvas-store.ts
  </files>
  <action>
**crazy-8s-types.ts:**
Define types for Crazy 8s sketch slots:

```typescript
export interface Crazy8sSlot {
  slotId: string;           // 'slot-1' through 'slot-8'
  title: string;            // User-editable title (empty string = untitled)
  imageUrl?: string;        // PNG URL from Vercel Blob (filled after drawing)
  drawingId?: string;       // Reference to drawing in stepArtifacts.drawings[]
}
```

Export `EMPTY_CRAZY_8S_SLOTS` constant:
```typescript
export const EMPTY_CRAZY_8S_SLOTS: Crazy8sSlot[] = Array.from({ length: 8 }, (_, i) => ({
  slotId: `slot-${i + 1}`,
  title: '',
}));
```

Export `CRAZY_8S_CANVAS_SIZE = { width: 800, height: 800 }` for square canvas (research pitfall #5 — avoid aspect ratio distortion).

**canvas-store.ts:**
Add Crazy 8s state alongside existing mind map state:

New state field in `CanvasState`:
- `crazy8sSlots: Crazy8sSlot[]`

New actions in `CanvasActions`:
- `updateCrazy8sSlot(slotId: string, updates: Partial<Crazy8sSlot>)` — find slot by slotId, merge updates, set isDirty
- `setCrazy8sSlots(slots: Crazy8sSlot[])` — bulk set for loading from DB, does NOT set isDirty

Add `crazy8sSlots` to temporal `partialize` for undo/redo.

Initialize `crazy8sSlots: []` in `createCanvasStore` (empty array, initialized by component when Step 8 loads).

Import `Crazy8sSlot` from `@/lib/canvas/crazy-8s-types`.
  </action>
  <verify>
Run `npx tsc --noEmit` — zero errors.
Grep `src/lib/canvas/crazy-8s-types.ts` for: Crazy8sSlot, EMPTY_CRAZY_8S_SLOTS, CRAZY_8S_CANVAS_SIZE.
Grep `src/stores/canvas-store.ts` for: crazy8sSlots, updateCrazy8sSlot, setCrazy8sSlots.
  </verify>
  <done>
Crazy8sSlot type defined with slotId, title, imageUrl, drawingId. Canvas store has crazy8sSlots array with update/set actions and undo/redo support. 800x800 canvas size constant exported.
  </done>
</task>

<task type="auto">
  <name>Task 2: Build Crazy 8s grid component</name>
  <files>
    src/components/workshop/crazy-8s-grid.tsx
  </files>
  <action>
Create the Crazy 8s grid component as an HTML grid (not ReactFlow canvas — per research, HTML grid is proven pattern from Journey Map):

**Props:**
```typescript
interface Crazy8sGridProps {
  slots: Crazy8sSlot[];
  onSlotClick: (slotId: string) => void;
  onTitleChange: (slotId: string, title: string) => void;
  aiPrompts?: string[];  // Optional sketch prompts from AI (Plan 28-05 feature hook)
}
```

**Layout:**
Use CSS grid: `grid grid-cols-4 gap-4` for 2 rows x 4 columns.

**Instructions header:**
```tsx
<div className="mb-4 p-4 rounded-lg border bg-muted/50">
  <p className="text-sm text-muted-foreground">
    Sketch 8 different ideas in 8 minutes. Tap any slot to draw, then add a title.
  </p>
</div>
```

**Slot rendering:**
For each slot in `slots` array (should always be 8):

```tsx
<div
  key={slot.slotId}
  className={cn(
    "relative aspect-square border-2 rounded-lg overflow-hidden transition-all cursor-pointer",
    slot.imageUrl
      ? "border-primary/50 hover:border-primary"
      : "border-dashed border-muted-foreground/30 hover:border-muted-foreground/60 bg-muted/20"
  )}
  onClick={() => onSlotClick(slot.slotId)}
>
```

**Slot number badge** (always visible):
```tsx
<div className="absolute top-2 left-2 z-10 w-6 h-6 rounded-full bg-background border flex items-center justify-center text-xs font-semibold">
  {index + 1}
</div>
```

**Empty slot content:**
- Center-aligned: Pencil icon SVG (from lucide-react `Pencil`) at 48x48, muted color, opacity-40
- Below icon: `<p className="text-xs text-muted-foreground">Click to sketch</p>`
- If `aiPrompts?.[index]` exists, show it below as: `<p className="text-xs text-muted-foreground/70 mt-1 italic max-w-[80%] text-center">{aiPrompts[index]}</p>`

**Filled slot content:**
- `<img src={slot.imageUrl} alt={slot.title || 'Sketch N'} className="w-full h-full object-cover" />`
- Title overlay at bottom: absolutely positioned div with `bg-background/90 backdrop-blur-sm p-2`
- Title input: `<input>` with `onClick={(e) => e.stopPropagation()}` to prevent slot click
- `onChange` calls `onTitleChange(slot.slotId, e.target.value)`
- Placeholder: "Add title..."
- Styling: `w-full bg-transparent text-xs font-medium outline-none placeholder:text-muted-foreground/50`

**Empty slot with title (edge case):**
- If slot has no imageUrl but has a title, still show empty state (title only shows with image)

Use `cn` utility for conditional classes. Import `Pencil` icon from lucide-react.
  </action>
  <verify>
Run `npx tsc --noEmit` — zero errors.
Run `npm run build` — production build succeeds.
Grep `src/components/workshop/crazy-8s-grid.tsx` for: Crazy8sGrid, grid-cols-4, aspect-square, onSlotClick, onTitleChange, Pencil.
  </verify>
  <done>
Crazy 8s grid displays 8 slots in 2x4 layout with number badges, empty/filled states, editable titles, and click handlers for EzyDraw integration. AI prompt placeholders supported.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with zero errors
2. `npm run build` succeeds
3. Crazy8sSlot type has slotId, title, imageUrl, drawingId fields
4. EMPTY_CRAZY_8S_SLOTS creates 8 empty slots
5. Canvas store has crazy8sSlots with update/set actions in temporal partialize
6. Grid renders 4 columns with aspect-square slots
7. Empty slots show pencil icon, filled slots show image
8. Title input stops click propagation (doesn't trigger slot click)
</verification>

<success_criteria>
- 8-slot grid displays in 2x4 layout with visual distinction between empty/filled
- Slot numbering (1-8) visible on all slots
- Title editing works on filled slots without triggering slot click
- Canvas store persists slot state with undo/redo
- Component ready for EzyDraw integration (Plan 28-05)
</success_criteria>

<output>
After completion, create `.planning/phases/28-mind-map-crazy-8s/28-04-SUMMARY.md`
</output>
