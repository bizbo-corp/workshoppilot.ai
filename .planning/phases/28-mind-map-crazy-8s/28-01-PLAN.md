---
phase: 28-mind-map-crazy-8s
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/canvas/mind-map-node.tsx
  - src/components/canvas/mind-map-edge.tsx
  - src/lib/canvas/mind-map-theme-colors.ts
  - src/lib/canvas/step-canvas-config.ts
autonomous: true

must_haves:
  truths:
    - "MindMapNode renders with theme-colored border and background"
    - "MindMapNode supports inline text editing with Enter/Escape/blur save"
    - "MindMapNode shows +Child and Delete action buttons on hover"
    - "MindMapEdge renders theme-colored bezier connection between parent and child"
    - "Theme colors auto-assign to level-1 branches and inherit to descendants"
    - "Step 8 has a canvas config entry in step-canvas-config.ts"
  artifacts:
    - path: "src/components/canvas/mind-map-node.tsx"
      provides: "Custom ReactFlow node for mind map with inline editing and actions"
      exports: ["MindMapNode", "MindMapNodeData"]
    - path: "src/components/canvas/mind-map-edge.tsx"
      provides: "Custom ReactFlow edge with theme-colored bezier curves"
      exports: ["MindMapEdge"]
    - path: "src/lib/canvas/mind-map-theme-colors.ts"
      provides: "Theme color palette and assignment logic for mind map branches"
      exports: ["THEME_COLORS", "ThemeColor", "ROOT_COLOR", "getThemeColorForNode"]
    - path: "src/lib/canvas/step-canvas-config.ts"
      provides: "Step 8 ideation canvas config entry"
      contains: "ideation"
  key_links:
    - from: "src/components/canvas/mind-map-node.tsx"
      to: "src/lib/canvas/mind-map-theme-colors.ts"
      via: "theme color styling"
      pattern: "themeColor.*themeBgColor"
    - from: "src/components/canvas/mind-map-edge.tsx"
      to: "src/lib/canvas/mind-map-theme-colors.ts"
      via: "edge color from source node theme"
      pattern: "style.*stroke"
---

<objective>
Create the custom MindMapNode and MindMapEdge ReactFlow components with theme color system for Step 8 mind map visualization.

Purpose: These components are the visual building blocks for the mind map canvas. The node supports inline text editing with action buttons (add child, delete), and the edge renders theme-colored bezier connections. A theme color palette auto-assigns colors to level-1 branches, which children inherit.

Output: Four new/modified files providing the node type, edge type, theme color system, and step config entry.
</objective>

<execution_context>
@/Users/michaelchristie/.claude/get-shit-done/workflows/execute-plan.md
@/Users/michaelchristie/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/28-mind-map-crazy-8s/28-RESEARCH.md

# Reference: existing ReactFlow node patterns
@src/components/canvas/post-it-node.tsx
@src/components/canvas/drawing-image-node.tsx
@src/lib/canvas/step-canvas-config.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create theme color system and MindMapNode component</name>
  <files>
    src/lib/canvas/mind-map-theme-colors.ts
    src/components/canvas/mind-map-node.tsx
  </files>
  <action>
**mind-map-theme-colors.ts:**
Create theme color palette with 6 preset colors for mind map branches. Each color has: id, label, color (border/text hex), bgColor (background hex).

Colors:
- blue: #3b82f6 / #dbeafe
- green: #10b981 / #d1fae5
- purple: #8b5cf6 / #ede9fe
- orange: #f97316 / #ffedd5
- pink: #ec4899 / #fce7f3
- yellow: #eab308 / #fef9c3

Export `ROOT_COLOR` as neutral gray (#6b7280 / #f3f4f6) for the central HMW node.

Export `THEME_COLORS` as const array and `ThemeColor` type.

Export `getThemeColorForNode(nodeId, nodes, edges)` function:
- If node has no parent edge (root): return ROOT_COLOR
- If parent is root: auto-assign based on sibling index (modulo THEME_COLORS.length)
- If parent has theme color: inherit parent's themeColorId
- Lookup themeColorId from node data, find matching THEME_COLORS entry

**mind-map-node.tsx:**
Create custom ReactFlow node component following existing post-it-node.tsx pattern:
- Use `memo()` wrapper with displayName
- Type: `MindMapNodeData` with fields: label, themeColorId, themeColor (hex), themeBgColor (hex), isRoot (boolean), level (number), onLabelChange callback, onAddChild callback, onDelete callback
- Export `MindMapNode` type as `Node<MindMapNodeData, 'mindMapNode'>`

Rendering:
- Outer div: `w-[200px] px-4 py-3 rounded-lg border-2 shadow-sm group` with dynamic borderColor and backgroundColor from data
- Handle type="target" on Position.Left, className="!w-2 !h-2 !bg-current" styled with themeColor
- Handle type="source" on Position.Right, same styling
- Root node: no target handle (it's the origin)

Inline editing:
- Local state: `isEditing` boolean, `editLabel` string
- Display mode: div with `cursor-text truncate font-medium text-sm` styled with themeColor, onClick enters edit mode
- Shows "Click to edit" placeholder if label is empty
- Edit mode: input with `w-full bg-transparent outline-none text-sm font-medium border-b-2` styled with themeColor
- onBlur saves via `data.onLabelChange?.(id, editLabel)` and exits edit mode
- onKeyDown: Enter saves, Escape reverts to original label
- autoFocus when entering edit mode
- CSS classes include `nodrag nopan` on the input to prevent ReactFlow interference

Action buttons:
- Container: `flex gap-1 mt-2 opacity-0 group-hover:opacity-100 transition-opacity`
- "+Child" button: `text-xs px-2 py-0.5 rounded hover:bg-white/50` styled with themeColor, calls `data.onAddChild?.(id)`
- Only show +Child if `data.level < 3` (max 3 levels deep, soft limit per research)
- "Delete" button: `text-xs px-2 py-0.5 rounded hover:bg-red-100 text-red-600`, calls `data.onDelete?.(id)`
- Don't show action buttons on root node (isRoot === true)
  </action>
  <verify>
Run `npx tsc --noEmit` — zero errors.
Grep `src/components/canvas/mind-map-node.tsx` for: memo, Handle, Position, MindMapNodeData, displayName, nodrag, nopan.
Grep `src/lib/canvas/mind-map-theme-colors.ts` for: THEME_COLORS, ROOT_COLOR, getThemeColorForNode.
  </verify>
  <done>
MindMapNode component renders themed node with inline editing and action buttons. Theme color system provides 6 colors with root gray and auto-assignment logic.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create MindMapEdge component and add Step 8 canvas config</name>
  <files>
    src/components/canvas/mind-map-edge.tsx
    src/lib/canvas/step-canvas-config.ts
  </files>
  <action>
**mind-map-edge.tsx:**
Create custom ReactFlow edge component for theme-colored connections:
- Use `memo()` wrapper with displayName
- Import `getBezierPath` from `@xyflow/react` for smooth bezier curves
- Type: `MindMapEdgeData` with fields: themeColor (hex string)
- Render SVG `<path>` with:
  - `d` from getBezierPath result
  - `stroke` from data.themeColor (fallback to '#94a3b8' gray if missing)
  - `strokeWidth={2}`
  - `fill="none"`
  - `className="transition-colors"`
- Add animated marker: small circle at target end using SVG `<circle>` at targetX/targetY with r=4, filled with themeColor

**step-canvas-config.ts:**
Add entry for Step 8 (ideation) canvas configuration. Step ID is 'ideation' (matches step-metadata.ts).

```typescript
'ideation': {
  hasQuadrants: false,
  // Mind map uses custom layout, not grid/quadrant overlays
  // Crazy 8s uses HTML grid overlay, not canvas grid
},
```

This is a minimal entry — mind map uses dagre layout (Plan 28-02) and Crazy 8s uses HTML grid (Plan 28-04), neither needs the quadrant/grid/ring overlay system. The entry exists to register Step 8 as a canvas-enabled step.
  </action>
  <verify>
Run `npx tsc --noEmit` — zero errors.
Run `npm run build` — production build succeeds.
Grep `src/components/canvas/mind-map-edge.tsx` for: getBezierPath, memo, MindMapEdgeData, displayName.
Grep `src/lib/canvas/step-canvas-config.ts` for: ideation.
  </verify>
  <done>
MindMapEdge renders theme-colored bezier connections between mind map nodes. Step 8 has a canvas config entry. TypeScript and production build pass.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with zero errors
2. `npm run build` succeeds
3. MindMapNode exports MindMapNodeData type and MindMapNode component
4. MindMapEdge exports MindMapEdgeData type and MindMapEdge component
5. THEME_COLORS has 6 entries, ROOT_COLOR exists
6. getThemeColorForNode handles root, level-1, and inherited colors
7. step-canvas-config.ts includes 'ideation' key
8. MindMapNode has nodrag/nopan classes on interactive elements
</verification>

<success_criteria>
- Custom mind map node renders with theme coloring, inline editing, and hover actions
- Custom mind map edge renders theme-colored bezier curves
- 6-color theme palette with auto-assignment logic ready for canvas integration
- Step 8 registered as canvas-enabled step
- All TypeScript compiles cleanly
</success_criteria>

<output>
After completion, create `.planning/phases/28-mind-map-crazy-8s/28-01-SUMMARY.md`
</output>
