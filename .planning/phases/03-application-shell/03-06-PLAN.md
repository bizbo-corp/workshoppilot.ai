---
phase: 03-application-shell
plan: 06
type: execute
wave: 4
depends_on: ["03-03", "03-04", "03-05"]
files_modified:
  - src/app/dashboard/page.tsx
  - src/app/dashboard/layout.tsx
  - src/components/dashboard/workshop-card.tsx
  - src/components/dashboard/dashboard-header.tsx
autonomous: false

must_haves:
  truths:
    - "Dashboard shows workshop cards with name, current step, and last active timestamp"
    - "Dashboard has 'Continue' for most recent workshop and 'Start New Workshop' as secondary CTA"
    - "User can rename workshop from dashboard via inline edit"
    - "Full end-to-end flow works: Landing -> Start Workshop -> Step pages with sidebar -> Exit to Dashboard -> Continue Workshop"
  artifacts:
    - path: "src/app/dashboard/page.tsx"
      provides: "Dashboard with workshop list from database"
    - path: "src/components/dashboard/workshop-card.tsx"
      provides: "Workshop card component showing name, step, last active"
    - path: "src/components/dashboard/dashboard-header.tsx"
      provides: "Dashboard-specific header"
    - path: "src/app/dashboard/layout.tsx"
      provides: "Dashboard layout wrapper"
  key_links:
    - from: "src/app/dashboard/page.tsx"
      to: "src/db/client.ts"
      via: "database query for user workshops"
      pattern: "db\\.query\\.workshops"
    - from: "src/components/dashboard/workshop-card.tsx"
      to: "/workshop/[sessionId]/step/[stepId]"
      via: "Link component navigation"
      pattern: "Link.*workshop"
---

<objective>
Rebuild the dashboard with workshop cards, continue/start CTAs, and inline workshop rename. Then verify the complete end-to-end flow with a visual checkpoint.

Purpose: The dashboard is the hub for managing multiple workshops. This plan also serves as the integration checkpoint where the complete flow is verified.
Output: Updated dashboard with real workshop data, workshop card component, end-to-end visual verification.
</objective>

<execution_context>
@/Users/michaelchristie/.claude/get-shit-done/workflows/execute-plan.md
@/Users/michaelchristie/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-application-shell/03-CONTEXT.md
@.planning/phases/03-application-shell/03-RESEARCH.md
@src/app/dashboard/page.tsx
@src/db/schema/workshops.ts
@src/db/schema/sessions.ts
@src/db/schema/steps.ts
@src/actions/workshop-actions.ts
@.planning/phases/03-application-shell/03-03-SUMMARY.md
@.planning/phases/03-application-shell/03-04-SUMMARY.md
@.planning/phases/03-application-shell/03-05-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build dashboard with workshop cards and management CTAs</name>
  <files>src/app/dashboard/page.tsx, src/app/dashboard/layout.tsx, src/components/dashboard/workshop-card.tsx, src/components/dashboard/dashboard-header.tsx, src/actions/workshop-actions.ts</files>
  <action>
**Create `src/components/dashboard/dashboard-header.tsx`:**

Dashboard-specific header (client component):
- Left: Logo linking to `/`
- Center or right: Theme toggle (sun/moon using next-themes `useTheme`)
- Right: UserButton from Clerk
- NOT sticky (scrolls with content per user decision)
- Clean, minimal style consistent with Linear aesthetic
- Dark mode support

**Create `src/app/dashboard/layout.tsx`:**

Simple layout for dashboard pages:
- Renders the DashboardHeader
- Wraps children in a max-width container with padding

**Create `src/components/dashboard/workshop-card.tsx`:**

Per user decision: "Workshop cards show: name + current step + last active"

Client component accepting workshop data:
- Card layout with subtle border, hover shadow (Linear style)
- Workshop name (bold, clickable -- links to workshop)
- Current step indicator: "Step 3: Ideate" (derived from workshopSteps data)
- Last active timestamp: "2 days ago" (use relative time formatting)
- "Continue" button linking to `/workshop/[sessionId]/step/[currentStep]`
- Inline rename: clicking the workshop name toggles to an input field. On blur or Enter, save via server action. Accept `onRename` callback prop.
- Per user decision: "User can rename workshop from dashboard or header (inline edit, click the name)"
- Dark mode support

**Add rename server action to `src/actions/workshop-actions.ts`:**

Add `renameWorkshop(workshopId: string, newName: string)` server action:
- Validates name is not empty, max 100 chars
- Updates workshop title in DB
- Calls `revalidatePath('/dashboard')`

**Rebuild `src/app/dashboard/page.tsx`:**

Replace the current placeholder dashboard with real data:
1. Keep auth check (defense in depth from Phase 2)
2. Query user's workshops from DB ordered by updatedAt desc
3. For each workshop, also query its sessions and current step progress
4. Layout:
   - Page header: "Your Workshops" title, welcome message
   - Primary CTA section: If user has workshops, show "Continue [most recent workshop name]" as a large prominent button/card. "Start New Workshop" as a smaller secondary button.
   - If no workshops: show empty state (similar to current) with "Start Workshop" CTA
   - Workshop card grid: display workshop cards in a responsive grid (1 col mobile, 2 cols md, 3 cols lg)
5. Per user decision: "Dashboard primary CTA: 'Continue' most recent workshop -- 'Start New' is secondary"
6. Keep the MigrationCheck component from Phase 2
7. Dark mode support throughout

DEFERRED (do NOT implement):
- Workshop delete/archive (per deferred decisions)
- Workshop search/filtering (per deferred decisions)
  </action>
  <verify>
Run `npm run build` to confirm no TypeScript errors.
Run `npm run dev` and verify:
1. Dashboard loads for authenticated users
2. If no workshops: shows empty state with "Start Workshop" button
3. If workshops exist: shows workshop cards with name, step, timestamp
4. "Start New Workshop" button works (creates session, redirects to step 1)
5. Clicking workshop card navigates to the workshop
6. Inline rename works on workshop name
  </verify>
  <done>Dashboard shows real workshop data from DB. Workshop cards display name, current step, last active. Primary CTA is "Continue" most recent workshop. Secondary CTA is "Start New Workshop". Inline rename works. Empty state shown when no workshops.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Verify complete end-to-end flow</name>
  <what-built>
Complete Phase 3 application shell: landing page with Start Workshop CTA, workshop creation flow, workshop layout with collapsible sidebar and header, all 10 step pages with chat/output split panels, dashboard with workshop cards, dark mode support throughout.
  </what-built>
  <how-to-verify>
Run `npm run dev` and test the full flow:

1. **Landing page** (http://localhost:3000):
   - Landing header visible with logo and auth controls
   - "Start Workshop" button visible and prominent
   - Dark mode toggle works (if visible on landing)

2. **Start Workshop flow**:
   - Click "Start Workshop" -- loading screen appears briefly
   - Redirects to `/workshop/[sessionId]/step/1`
   - Step 1 page renders with sidebar, header, chat panel, output panel

3. **Workshop shell**:
   - Sidebar shows all 10 steps numbered with names
   - Click sidebar items to navigate between steps (1 through 10)
   - Each step shows different greeting and mock output content
   - Cmd+B (Mac) or Ctrl+B (Win) toggles sidebar collapse
   - Sidebar state persists on page refresh
   - Exit Workshop button opens confirmation dialog
   - Confirming exit navigates to dashboard

4. **Step pages**:
   - Chat panel: greeting message visible, disabled input with placeholder
   - Output panel: step-specific mock content visible
   - Resize handle between panels works (drag to resize)
   - On narrow viewport: panels stack vertically

5. **Dashboard** (http://localhost:3000/dashboard):
   - Shows the workshop you just created
   - Workshop card shows name ("New Workshop"), current step, timestamp
   - "Continue" links back to the workshop
   - "Start New Workshop" creates another session
   - Click workshop name to rename inline

6. **Dark mode**:
   - Toggle between light and dark mode
   - All pages render correctly in both modes
   - No unstyled or broken elements in dark mode

7. **Mobile** (resize browser to <768px):
   - Sidebar disappears, mobile stepper appears at top
   - Step pages stack chat on top, output below
   - Navigation still works
  </how-to-verify>
  <resume-signal>Type "approved" to complete Phase 3, or describe any issues that need fixing.</resume-signal>
</task>

</tasks>

<verification>
- `npm run build` passes
- Full flow: Landing -> Start Workshop -> Step 1 -> Navigate steps -> Exit -> Dashboard -> Continue
- All 10 steps render with unique content
- Sidebar, header, chat/output panels all functional
- Dark mode works across all pages
- Mobile layout works
- Dashboard shows real workshop data
</verification>

<success_criteria>
All Phase 3 requirements satisfied:
- SCAF-01: App shell with header, sidebar, main content area
- SCAF-02: Desktop-first layout with consistent navigation
- SCAF-03: Route structure follows /workshop/[sessionId]/step/[stepId]
- SCAF-04: Landing page with "Start Workshop" entry point
- STEP-01: All 10 steps exist as routable pages
- STEP-02: Each step displays name, number, placeholder
- STEP-03: Step content area ready for AI chat and form components

Complete end-to-end flow verified by user.
</success_criteria>

<output>
After completion, create `.planning/phases/03-application-shell/03-06-SUMMARY.md`
</output>
