---
phase: 03-application-shell
plan: 05
type: execute
wave: 3
depends_on: ["03-02", "03-04"]
files_modified:
  - src/app/workshop/[sessionId]/step/[stepId]/page.tsx
  - src/components/workshop/step-container.tsx
  - src/components/workshop/chat-panel.tsx
  - src/components/workshop/output-panel.tsx
autonomous: true

must_haves:
  truths:
    - "All 10 design thinking steps exist as routable pages at /workshop/[sessionId]/step/[1-10]"
    - "Each step displays its number, name, and description"
    - "Step page has side-by-side split with chat on left and output on right"
    - "Split divider is resizable by dragging"
    - "Chat panel shows disabled input with 'AI facilitation coming soon...' placeholder"
    - "Chat panel shows step-specific AI greeting message"
    - "Output panel shows step-specific mock content previewing the output type"
    - "On mobile, layout stacks vertically (chat on top, outputs below)"
  artifacts:
    - path: "src/app/workshop/[sessionId]/step/[stepId]/page.tsx"
      provides: "Dynamic step page rendering the correct step content"
    - path: "src/components/workshop/step-container.tsx"
      provides: "Resizable split panel layout for chat + output"
    - path: "src/components/workshop/chat-panel.tsx"
      provides: "Chat area with disabled input and greeting message"
    - path: "src/components/workshop/output-panel.tsx"
      provides: "Output area with step-specific mock content"
  key_links:
    - from: "src/app/workshop/[sessionId]/step/[stepId]/page.tsx"
      to: "src/lib/workshop/step-metadata.ts"
      via: "getStepByOrder lookup"
      pattern: "getStepByOrder"
    - from: "src/components/workshop/step-container.tsx"
      to: "react-resizable-panels"
      via: "PanelGroup import"
      pattern: "PanelGroup|Panel|PanelResizeHandle"
    - from: "src/components/workshop/chat-panel.tsx"
      to: "react-textarea-autosize"
      via: "expanding input"
      pattern: "TextareaAutosize"
---

<objective>
Create the step page with resizable chat/output split panels. All 10 steps are routable pages displaying step info, a chat shell placeholder, and step-specific mock output content.

Purpose: This delivers STEP-01, STEP-02, and STEP-03 requirements -- all 10 steps as routable pages with structured containers ready for AI chat and form components.
Output: Dynamic step page, resizable split container, chat panel with disabled input, output panel with mock content.
</objective>

<execution_context>
@/Users/michaelchristie/.claude/get-shit-done/workflows/execute-plan.md
@/Users/michaelchristie/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-application-shell/03-CONTEXT.md
@.planning/phases/03-application-shell/03-RESEARCH.md
@src/lib/workshop/step-metadata.ts
@.planning/phases/03-application-shell/03-02-SUMMARY.md
@.planning/phases/03-application-shell/03-04-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create chat panel and output panel components</name>
  <files>src/components/workshop/chat-panel.tsx, src/components/workshop/output-panel.tsx</files>
  <action>
**Create `src/components/workshop/chat-panel.tsx`:**

Client component (`'use client'`) implementing the chat area per user decisions:
- "Real chat shell placeholder -- actual input box (disabled) + empty message area"
- "AI greeting per step -- pre-populated welcome message"
- "Chat input is an expanding textarea -- starts single line, grows as user types"
- "Send behavior: Enter sends, Shift+Enter for newline (standard chat pattern)"
- "Disabled input shows placeholder text: 'AI facilitation coming soon...'"

Implementation:
1. Accept `stepOrder` prop (number 1-10)
2. Import `getStepByOrder` from step-metadata to get the greeting message
3. Message area: a scrollable container showing the AI greeting message as the first "message" styled as an AI message bubble (left-aligned, muted background)
4. Input area at the bottom:
   - Use `react-textarea-autosize` with `minRows={1}` and `maxRows={6}`
   - Input is DISABLED with placeholder "AI facilitation coming soon..."
   - Send button (disabled) to the right of the input
   - Style: subtle border, rounded corners, muted placeholder text
5. Handle Enter key behavior (for future -- currently disabled):
   - `onKeyDown`: if Enter without Shift, prevent default (would send). With Shift, allow newline.
   - Since disabled, this is structural preparation only
6. Visual style: clean, minimal, proper spacing. Dark mode support.
7. The chat panel should fill its container height with the message area flexing and input pinned to bottom.

**Create `src/components/workshop/output-panel.tsx`:**

Client component (`'use client'`) implementing the output area per user decisions:
- "Output panel shows step-specific mock content -- each step previews its output type"
- "All steps have uniform visual treatment (no per-step color accents)"

Implementation:
1. Accept `stepOrder` prop (number 1-10)
2. Import `getStepByOrder` from step-metadata to get mockOutputType and mockOutputContent
3. Header section: output type label (e.g., "Problem Statement & HMW", "User Persona Card", "Mind Map & Idea Cards")
4. Content area: display the mock output content in a structured, readable format
   - Use a card or bordered container
   - Monospace or slightly formatted text for the mock content
   - Style as "preview" -- slightly muted to indicate this is placeholder
   - Maybe a small info badge: "Preview -- AI-generated content will appear here"
5. Full height, scrollable if content overflows
6. Visual style: clean borders, subtle background differentiation from chat panel, dark mode

NOTE: The step metadata module uses the correct WorkshopPilot step names and content. Step 1 is "Challenge" (not "Empathize"), Step 5 is "Persona Development" (not "Test"), etc. The components just consume whatever step-metadata provides -- they don't hardcode step names.
  </action>
  <verify>
Run `npm run build` to confirm no TypeScript errors.
Verify both components accept `stepOrder` prop and render content from step-metadata.
  </verify>
  <done>Chat panel shows greeting message and disabled expanding textarea. Output panel shows step-specific mock content with output type label. Both support dark mode and fill their container.</done>
</task>

<task type="auto">
  <name>Task 2: Create step container and step page</name>
  <files>src/components/workshop/step-container.tsx, src/app/workshop/[sessionId]/step/[stepId]/page.tsx</files>
  <action>
**Create `src/components/workshop/step-container.tsx`:**

Per user decisions:
- "Side-by-side split: chat area on left, output panel on right"
- "Split divider is resizable (user can drag to adjust proportions)"
- "Chat and output panel are equal split (50/50) by default"
- "On mobile: stacked layout -- chat on top, outputs below"

Implementation using `react-resizable-panels` (per research Pattern 3):
1. Accept `stepOrder` prop
2. Use `PanelGroup` with `direction="horizontal"` for desktop
3. Left Panel: `ChatPanel` with `defaultSize={50}`, `minSize={30}`
4. `PanelResizeHandle`: style as a subtle divider with touch-friendly invisible padding (per research Pitfall 3 -- at least 24px touch target around the 1px visual line)
5. Right Panel: `OutputPanel` with `defaultSize={50}`, `minSize={25}`
6. Use media query or Tailwind responsive classes: below `md` breakpoint, switch to stacked layout (no PanelGroup, just flex-col with ChatPanel on top and OutputPanel below)
7. Consider using `onLayout` callback to persist panel sizes in localStorage (use `useLocalStorage` from Plan 04). Key: `'workshoppilot-panel-layout'`
8. Full height of the container (parent provides height constraints)
9. The resize handle should show a visual indicator on hover (thin accent line)

**Create `src/app/workshop/[sessionId]/step/[stepId]/page.tsx`:**

Dynamic route page for individual steps:
1. This can be a server component that validates the step exists, then renders client step container
2. Parse `params.stepId` as a number (1-10). If outside range, redirect to step 1 or show 404.
3. Look up step data from step-metadata using `getStepByOrder(stepNumber)`
4. If step not found, redirect to step 1
5. Render a page wrapper with:
   - Step header area showing "Step {N}: {Name}" and the brief description
   - Below: `StepContainer` component with the step order
6. The step header should be compact (not take too much vertical space) since the main content is the chat/output split
7. IMPORTANT: Next.js 16 `params` are async. Use `const { sessionId, stepId } = await params;`
8. The page should fill the remaining height in the layout (the layout's main content area)

Note: For this phase, all steps are navigable (no sequential enforcement -- that's Phase 4).

The step names displayed will be the CORRECT WorkshopPilot names from step-metadata:
- Step 1: Challenge, Step 2: Stakeholder Mapping, Step 3: User Research, Step 4: Research Sense Making,
  Step 5: Persona Development, Step 6: Journey Mapping, Step 7: Reframing Challenge, Step 8: Ideation,
  Step 9: Concept Development, Step 10: Validate
  </action>
  <verify>
Run `npm run build` to confirm no TypeScript errors.
Run `npm run dev` and test:
1. Navigate to `/workshop/ses_test123/step/1` -- should show Step 1: Challenge with chat + output panels
2. Navigate to `/workshop/ses_test123/step/5` -- should show Step 5: Persona Development with different mock content
3. Navigate to `/workshop/ses_test123/step/10` -- should show Step 10: Validate
4. Resize the split divider -- panels should resize smoothly
5. On narrow viewport (< 768px), panels should stack vertically
6. Invalid step number (0, 11, abc) should redirect to step 1
  </verify>
  <done>All 10 steps are routable at /workshop/[sessionId]/step/[1-10]. Each step shows its correct WorkshopPilot name (Challenge, Stakeholder Mapping, User Research, etc.), description, chat panel with greeting, and output panel with mock content. Panels are resizable with drag handle. Mobile layout stacks vertically.</done>
</task>

</tasks>

<verification>
- `npm run build` passes
- All 10 step URLs are routable and render unique content
- Each step shows: number, correct name (Challenge, Stakeholder Mapping, etc.), description, greeting message, mock output
- Chat input is disabled with "AI facilitation coming soon..." placeholder
- Resizable split panel works with drag handle
- Mobile stacked layout works below md breakpoint
- Dark mode support throughout
</verification>

<success_criteria>
Requirements STEP-01 (all 10 steps routable), STEP-02 (name, number, placeholder), and STEP-03 (hollow container ready for AI chat) are satisfied. The step content area is a structured two-panel layout ready to receive real AI chat and output components. All step names and content match WorkshopPilot's actual 10-step flow.
</success_criteria>

<output>
After completion, create `.planning/phases/03-application-shell/03-05-SUMMARY.md`
</output>
