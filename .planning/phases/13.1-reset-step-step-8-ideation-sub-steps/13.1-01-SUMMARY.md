---
phase: 13.1-reset-step-step-8-ideation-sub-steps
plan: 01
subsystem: workshop-navigation
tags: [reset, cascade-invalidation, destructive-action, confirmation-dialog]
dependency_graph:
  requires:
    - cascade-invalidation.ts (invalidateDownstreamSteps)
    - workshop-actions.ts (reviseStep pattern)
    - exit-workshop-dialog.tsx (dialog pattern)
  provides:
    - resetStep server action (deletes messages, artifacts, summaries)
    - ResetStepDialog component (confirmation UI)
    - Reset button in step navigation (destructive action trigger)
  affects:
    - step-container.tsx (reset state management)
    - step-navigation.tsx (reset button UI)
tech_stack:
  added: []
  patterns:
    - Destructive server action with multi-table deletion
    - Confirmation dialog with loading state
    - Portal-rendered dialog outside layout ternary
    - Cascade invalidation for downstream steps
key_files:
  created:
    - src/components/dialogs/reset-step-dialog.tsx
  modified:
    - src/actions/workshop-actions.ts
    - src/components/workshop/step-container.tsx
    - src/components/workshop/step-navigation.tsx
decisions:
  - "resetStep more destructive than reviseStep: clears messages/artifacts/summaries before cascade"
  - "Reset button shown only on in_progress and needs_regeneration steps (not completed)"
  - "Dialog variant='destructive' with red button emphasizes data loss risk"
  - "ResetStepDialog renders once as portal, not duplicated in mobile/desktop branches"
  - "After reset, step returns to in_progress with arcPhase: orient (fresh start)"
metrics:
  duration: 3m
  completed_date: 2026-02-10
---

# Phase 13.1 Plan 01: Reset Step Functionality Summary

**One-liner:** Destructive reset action that clears conversation, artifact, and summary for current step with cascade invalidation of downstream steps.

## What Was Built

Added "Reset Step" functionality that allows users to completely clear a step's data and start fresh, extending the existing "Revise This Step" pattern with a more destructive option.

### Components Created

1. **resetStep Server Action** (`src/actions/workshop-actions.ts`)
   - Finds workshopStep record by workshopId and stepId
   - Deletes chat messages for the step (sessionId + stepId)
   - Deletes step artifact (workshopStepId)
   - Deletes step summary (workshopStepId)
   - Calls invalidateDownstreamSteps (resets current to in_progress, marks downstream as needs_regeneration)
   - Revalidates workshop path
   - Error handling with console.error and re-throw

2. **ResetStepDialog Component** (`src/components/dialogs/reset-step-dialog.tsx`)
   - Confirmation dialog following exit-workshop-dialog pattern
   - Props: open, onOpenChange, onConfirm, isResetting, stepName
   - Dialog title: "Reset {stepName}?"
   - Description warns about clearing conversation, output, summary, and downstream cascade
   - Footer: Cancel button (outline) + Reset Step button (destructive variant)
   - Loading state: "Resetting..." text when isResetting=true

3. **Step Navigation Integration** (`src/components/workshop/step-navigation.tsx`)
   - Added RotateCcw icon import
   - Added onReset optional callback to props interface
   - Added Reset button in left section (flex container with Back button)
   - Reset button shown when stepStatus is in_progress or needs_regeneration
   - Ghost variant with text-muted-foreground hover:text-destructive styling
   - Disabled when isNavigating

4. **Step Container Wiring** (`src/components/workshop/step-container.tsx`)
   - Imported ResetStepDialog and resetStep action
   - Imported getStepByOrder at top level for dialog rendering
   - Added showResetDialog and isResetting state
   - Added handleReset callback: calls resetStep, clears local state (artifact, artifactConfirmed, extractionError), refreshes page
   - Passed onReset={() => setShowResetDialog(true)} to both mobile and desktop StepNavigation
   - Rendered ResetStepDialog once outside mobile/desktop ternary (portal overlay)

## Deviations from Plan

None - plan executed exactly as written.

## Key Implementation Details

**Multi-Table Deletion Pattern:**
- resetStep deletes from 3 tables: chatMessages, stepArtifacts, stepSummaries
- Requires workshopStepId lookup first (chatMessages uses sessionId, others use workshopStepId)
- All deletions use .where() with proper foreign key relationships

**Dialog Rendering Pattern:**
- Dialog rendered once after mobile/desktop ternary, not duplicated in each branch
- Dialog is a portal component, so it renders above all layout elements
- Both mobile and desktop StepNavigation instances receive same onReset callback

**Reset vs Revise Distinction:**
- reviseStep: preserves data, just marks step for revision (needs_regeneration)
- resetStep: destructive - deletes all data, then calls invalidateDownstreamSteps
- Both end with step in in_progress status with arcPhase: orient

**Visual Hierarchy:**
- Reset button is ghost variant (low prominence) vs Revise is outline variant (medium prominence)
- Reset button uses hover:text-destructive to hint at destructive nature
- Dialog uses variant="destructive" for red confirmation button

## Testing Verification

Built successfully with `npm run build`:
- TypeScript compilation passes with no errors
- All 4 modified/created files compile correctly
- No build warnings or errors
- Build output shows all routes compiled successfully

## Next Phase Readiness

**Blockers:** None

**Enablers for Phase 13.1 Plan 02 (Step 8 Sub-Steps):**
- Reset functionality provides clean slate for testing sub-step restructure
- Users can reset Step 8 to test new ideation rounds from scratch
- Cascade invalidation ensures downstream steps (9-10) properly invalidate after Step 8 reset

## Self-Check: PASSED

**Created files exist:**
```
FOUND: src/components/dialogs/reset-step-dialog.tsx
```

**Modified files exist:**
```
FOUND: src/actions/workshop-actions.ts
FOUND: src/components/workshop/step-container.tsx
FOUND: src/components/workshop/step-navigation.tsx
```

**Commits exist:**
```
FOUND: c4e6241 (Task 1: resetStep server action and ResetStepDialog)
FOUND: 1587dc9 (Task 2: wire reset functionality into StepNavigation and StepContainer)
```

**Key exports verified:**
- resetStep exported from src/actions/workshop-actions.ts
- ResetStepDialog exported from src/components/dialogs/reset-step-dialog.tsx
- onReset prop added to StepNavigationProps interface
- Reset button renders on in_progress and needs_regeneration steps

All claims in summary verified against actual implementation.
