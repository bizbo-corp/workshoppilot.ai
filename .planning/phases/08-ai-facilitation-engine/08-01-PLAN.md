---
phase: 08-ai-facilitation-engine
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/lib/ai/prompts/step-prompts.ts
  - src/lib/ai/prompts/arc-phases.ts
  - src/lib/ai/prompts/validation-criteria.ts
autonomous: true

must_haves:
  truths:
    - "Each of the 10 steps has a dedicated prompt with step-specific instructions"
    - "Each arc phase (Orient, Gather, Synthesize, Refine, Validate, Complete) has behavioral instructions"
    - "Each step has quality validation criteria the AI uses to assess output"
    - "Step prompts reference what prior step outputs to look for by name"
  artifacts:
    - path: "src/lib/ai/prompts/step-prompts.ts"
      provides: "Step-specific prompt instructions for all 10 steps"
      exports: ["getStepSpecificInstructions"]
      min_lines: 100
    - path: "src/lib/ai/prompts/arc-phases.ts"
      provides: "Conversational arc phase behavioral instructions"
      exports: ["ArcPhase", "getArcPhaseInstructions", "ARC_PHASE_ORDER"]
      min_lines: 40
    - path: "src/lib/ai/prompts/validation-criteria.ts"
      provides: "Quality criteria per step for AI validation"
      exports: ["getValidationCriteria", "ValidationCriterion"]
      min_lines: 80
  key_links:
    - from: "src/lib/ai/prompts/step-prompts.ts"
      to: "src/lib/workshop/step-metadata.ts"
      via: "Step IDs match metadata IDs"
      pattern: "challenge|stakeholder-mapping|user-research|sense-making|persona|journey-mapping|reframe|ideation|concept|validate"
    - from: "src/lib/ai/prompts/validation-criteria.ts"
      to: "src/lib/ai/prompts/step-prompts.ts"
      via: "Same step IDs used for both instructions and validation"
      pattern: "stepId.*string"
---

<objective>
Create step-specific prompt templates, conversational arc phase instructions, and quality validation criteria for all 10 design thinking steps.

Purpose: This is the content layer of the AI facilitation engine. Each step needs dedicated instructions telling the AI what to do, what to gather, and how to validate quality. The 6-phase arc (Orient -> Gather -> Synthesize -> Refine -> Validate -> Complete) provides structure to each step's conversation flow.

Output: Three new files in src/lib/ai/prompts/ containing all prompt content needed by the chat API.
</objective>

<execution_context>
@/Users/michaelchristie/.claude/get-shit-done/workflows/execute-plan.md
@/Users/michaelchristie/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-ai-facilitation-engine/08-RESEARCH.md
@src/lib/workshop/step-metadata.ts
@src/lib/ai/chat-config.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create arc phase instructions and step-specific prompt templates</name>
  <files>src/lib/ai/prompts/arc-phases.ts, src/lib/ai/prompts/step-prompts.ts</files>
  <action>
Create `src/lib/ai/prompts/arc-phases.ts`:
- Export type `ArcPhase = 'orient' | 'gather' | 'synthesize' | 'refine' | 'validate' | 'complete'`
- Export const `ARC_PHASE_ORDER: ArcPhase[]` for ordered phase list
- Export function `getArcPhaseInstructions(phase: ArcPhase): string` that returns behavioral instructions per phase:
  - orient: Welcome user, explain step purpose, reference prior outputs, ask first question
  - gather: Ask focused questions to collect info, use prior context for specificity, one question at a time
  - synthesize: Present draft output, show reasoning ("Here's what I'm hearing..."), ask for review
  - refine: Help user improve draft, listen for changes, iterate until satisfied
  - validate: Check output against quality criteria, provide constructive feedback, suggest improvements
  - complete: Congratulate, summarize accomplishments, preview next step
- Use the exact instruction text from the research (Pattern 2 in 08-RESEARCH.md) as a starting point, but enrich each phase with 3-4 sentences of actionable guidance

Create `src/lib/ai/prompts/step-prompts.ts`:
- Export function `getStepSpecificInstructions(stepId: string): string`
- Must cover ALL 10 step IDs from step-metadata.ts: 'challenge', 'stakeholder-mapping', 'user-research', 'sense-making', 'persona', 'journey-mapping', 'reframe', 'ideation', 'concept', 'validate'
- Each step instruction must include:
  1. STEP GOAL: What this step produces (from step-metadata.ts description)
  2. DESIGN THINKING PRINCIPLES: 2-3 methodology principles specific to this step
  3. GATHERING REQUIREMENTS: What information the AI needs to collect from the user
  4. PRIOR CONTEXT USAGE: Which prior step outputs to reference and how (e.g., persona step says "Reference Step 4 pains/gains to ground persona traits")
- For steps 1-4 (Discovery cluster): Focus on exploration and research
- For steps 5-7 (Definition cluster): Focus on synthesis and insight extraction, reference prior step outputs heavily
- For steps 8-10 (Ideation/Validation cluster): Focus on creativity and evaluation, reference persona, HMW, and journey dip
- Return generic fallback string for unknown stepId (defensive coding)
- Do NOT import from step-metadata.ts (keep prompt content self-contained, avoid circular deps)
  </action>
  <verify>
`npx tsc --noEmit` passes. Both files export their expected functions. Grep confirms all 10 step IDs appear in step-prompts.ts. Grep confirms all 6 arc phases appear in arc-phases.ts.
  </verify>
  <done>
All 10 steps have dedicated instructions with STEP GOAL, DESIGN THINKING PRINCIPLES, GATHERING REQUIREMENTS, and PRIOR CONTEXT USAGE sections. All 6 arc phases have behavioral instructions. TypeScript compiles without errors.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create validation criteria per step</name>
  <files>src/lib/ai/prompts/validation-criteria.ts</files>
  <action>
Create `src/lib/ai/prompts/validation-criteria.ts`:
- Export interface `ValidationCriterion` with fields: `name: string`, `description: string`, `checkPrompt: string` (question the AI asks itself to check)
- Export function `getValidationCriteria(stepId: string): ValidationCriterion[]`
- Define 2-4 criteria per step. Key criteria by step:
  - challenge: Specificity (not too broad/narrow), Target User identified, Measurable Outcome implied
  - stakeholder-mapping: Coverage (Core/Direct/Indirect categories populated), Prioritization (power/interest mapped), Relevance to challenge
  - user-research: Question Quality (open-ended, not leading), Insight Depth (specific findings, not generic), Coverage (multiple stakeholder types)
  - sense-making: Theme Coherence (themes supported by evidence), Pain/Gain Balance (5 each with evidence), Research Grounding (traces to Step 3 insights)
  - persona: Research Grounding (traits from Step 4 pains/gains), Specificity (concrete name/role/context), Actionability (enables design decisions)
  - journey-mapping: Stage Coverage (4-8 stages), Multi-Layer (actions/thoughts/emotions per stage), Dip Identification (clear pain point marked)
  - reframe: Research Alignment (references persona and journey dip), Narrower Focus (more specific than original HMW), Actionability (implies solution space)
  - ideation: Quantity (minimum 8-10 ideas across categories), Diversity (ideas span different approaches), HMW Alignment (ideas address the reframed challenge)
  - concept: Completeness (name, pitch, USP, SWOT, feasibility), Evidence-Based (SWOT references research/persona), Feasibility Realism (scores have rationale)
  - validate: Comprehensiveness (references all 10 steps), Narrative Coherence (story flows from problem to solution), Actionability (clear next steps)
- Return empty array for unknown stepId
- Each checkPrompt should be a specific yes/no question the AI can evaluate, NOT generic ("Is this good?")
  </action>
  <verify>
`npx tsc --noEmit` passes. Grep confirms all 10 step IDs have validation criteria defined. Each step has at least 2 criteria.
  </verify>
  <done>
All 10 steps have 2-4 specific validation criteria with checkPrompt questions. Unknown step IDs return empty array. TypeScript compiles.
  </done>
</task>

</tasks>

<verification>
- `npx tsc --noEmit` passes with zero errors
- All 10 step IDs from step-metadata.ts appear in step-prompts.ts
- All 6 arc phases defined in arc-phases.ts
- All 10 step IDs have validation criteria in validation-criteria.ts
- No circular imports between prompt files and step-metadata.ts
</verification>

<success_criteria>
- Step-specific instructions exist for all 10 design thinking steps with methodology grounding
- Arc phase instructions cover all 6 phases with actionable behavioral guidance
- Validation criteria exist for all 10 steps with specific checkPrompt questions
- All exports are typed and compile cleanly
</success_criteria>

<output>
After completion, create `.planning/phases/08-ai-facilitation-engine/08-01-SUMMARY.md`
</output>
