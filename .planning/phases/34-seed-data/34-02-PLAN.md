---
phase: 34-seed-data
plan: 02
type: execute
wave: 2
depends_on: ["34-01"]
files_modified:
  - scripts/seed-workshop.ts
  - package.json
autonomous: false
must_haves:
  truths:
    - "Developer can run a single CLI command to seed a PawPal workshop"
    - "Seeded workshop appears on the dashboard"
    - "Seeded workshop is navigable through all 10 steps"
    - "Canvas state loads correctly for Steps 2, 4, 6, 8, and 9"
  artifacts:
    - path: "scripts/seed-workshop.ts"
      provides: "CLI seed script for PawPal workshop"
      contains: "seedWorkshop"
    - path: "package.json"
      provides: "db:seed:workshop npm script"
      contains: "seed-workshop"
  key_links:
    - from: "scripts/seed-workshop.ts"
      to: "src/app/api/dev/seed-workshop/fixtures.ts"
      via: "PAWPAL_FIXTURES import"
      pattern: "PAWPAL_FIXTURES"
    - from: "scripts/seed-workshop.ts"
      to: "src/db/client.ts"
      via: "db import for direct inserts"
      pattern: "import.*db.*from"
---

<objective>
Create a CLI seed script that inserts a complete PawPal workshop directly into the database (bypassing the HTTP route and Clerk auth), and verify the seeded workshop works end-to-end in the browser.

Purpose: The existing seed route requires the dev server running and Clerk authentication. A CLI script lets developers seed data before even starting the server, and supports CI/testing scenarios.

Output: `scripts/seed-workshop.ts` executable via `npm run db:seed:workshop`, verified working workshop in browser.
</objective>

<execution_context>
@/Users/michaelchristie/.claude/get-shit-done/workflows/execute-plan.md
@/Users/michaelchristie/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/34-seed-data/34-01-SUMMARY.md
@src/app/api/dev/seed-workshop/route.ts
@src/app/api/dev/seed-workshop/fixtures.ts
@scripts/seed-steps.ts
@src/db/client.ts
@src/db/schema/index.ts
@src/lib/ids.ts
@src/lib/schemas/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create CLI seed script and npm command</name>
  <files>scripts/seed-workshop.ts, package.json</files>
  <action>
Create `scripts/seed-workshop.ts` modeled after the existing `scripts/seed-steps.ts` pattern (direct DB access via `../src/db/client`, no HTTP/Clerk dependency).

The script should:

1. Accept an optional `--clerk-user-id` CLI argument (defaults to a placeholder like `user_seed_pawpal` for development). Also accept optional `--up-to-step` argument (defaults to `validate` for all 10 steps).

2. Import and reuse `PAWPAL_FIXTURES` from `../src/app/api/dev/seed-workshop/fixtures` and `STEPS` from `../src/lib/workshop/step-metadata`.

3. Validate all fixtures against Zod schemas using `getSchemaForStep` from `../src/lib/schemas` — same validation as the route. If validation fails, print errors and exit 1.

4. Insert data in this order (same as route.ts logic):
   a. Workshop record: title='PawPal Pet Care App', originalIdea from fixture, status based on upToStep
   b. Session record linked to workshop
   c. All 10 workshopStep records with correct status/arcPhase based on upToStep
   d. StepArtifact records for seeded steps (merging canvasData or canvas into _canvas key — same logic as updated route)
   e. StepSummary records for seeded steps

5. Print summary on success:
   ```
   Seeded PawPal workshop:
     Workshop ID: ws_xxxxx
     Session ID: ses_xxxxx
     Steps seeded: challenge, stakeholder-mapping, ..., validate
     Clerk User ID: user_seed_pawpal
     URL: /workshop/ws_xxxxx/challenge
   ```

6. Use try/catch with process.exit(1) on failure, process.exit(0) on success.

7. Add npm script to package.json:
   ```json
   "db:seed:workshop": "dotenv -e .env.local -- tsx scripts/seed-workshop.ts"
   ```
  </action>
  <verify>Run `npm run db:seed:workshop` and verify it prints the success summary with a workshop ID. Then verify the workshop exists: `npm run db:seed:workshop -- --clerk-user-id test_user_123` (should create a second workshop for that user).</verify>
  <done>CLI command `npm run db:seed:workshop` successfully inserts a complete PawPal workshop with all 10 steps, artifacts, summaries, and canvas state into the database. The script validates fixtures against Zod schemas before inserting.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Verify seeded workshop in browser</name>
  <what-built>Complete PawPal seed data with all 10 steps, canvas state for Steps 2/4/6/8/9, and CLI seed command</what-built>
  <how-to-verify>
1. Start the dev server: `npm run dev`
2. Sign in to the app at http://localhost:3000
3. Run `npm run db:seed:workshop -- --clerk-user-id YOUR_CLERK_USER_ID` (use your actual Clerk user ID from the browser dev tools or Clerk dashboard)
4. Refresh the dashboard — PawPal Pet Care App should appear in the workshop list
5. Click into the workshop and navigate through each step:
   - Step 1 (Challenge): Should show completed status
   - Step 2 (Stakeholder Mapping): Should show 6 post-its on canvas in ring layout
   - Step 4 (Sense Making): Should show post-its in empathy map zones
   - Step 6 (Journey Mapping): Should show post-its in grid cells
   - Step 8 (Ideation): Should show mind map tree with root + 3 themes + child ideas, and 8 Crazy 8s slots with titles
   - Step 9 (Concept): Should show 2 concept cards with full data
   - Step 10 (Validate): Should show completed status with synthesis artifact
6. Verify navigation between steps works without errors
  </how-to-verify>
  <resume-signal>Type "approved" if seeded workshop appears and is navigable, or describe any issues</resume-signal>
</task>

</tasks>

<verification>
- CLI command runs without errors: `npm run db:seed:workshop`
- Workshop appears on dashboard when signed in as the seeded user
- All 10 steps show correct completion status
- Canvas state loads for Steps 2, 4, 6, 8, and 9 with appropriate visual representations
- No console errors when navigating between steps
</verification>

<success_criteria>
1. `npm run db:seed:workshop` creates a complete PawPal workshop in the database
2. Seeded workshop visible on dashboard and navigable through all 10 steps
3. Canvas state (post-its, mind map, Crazy 8s, concept cards) renders correctly on relevant steps
4. Seeded data demonstrates a realistic design thinking workshop progression
</success_criteria>

<output>
After completion, create `.planning/phases/34-seed-data/34-02-SUMMARY.md`
</output>
