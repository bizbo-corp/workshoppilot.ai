---
phase: 43-workshop-completion
plan: 02
type: execute
wave: 2
depends_on:
  - 43-01
files_modified:
  - src/components/workshop/step-container.tsx
  - src/components/workshop/step-navigation.tsx
  - src/components/workshop/synthesis-summary-view.tsx
  - src/components/workshop/deliverable-card.tsx
autonomous: true
requirements:
  - COMP-01
  - COMP-02

must_haves:
  truths:
    - "User on Step 10 sees the AI-facilitated synthesis summary reviewing all 10 steps (narrative, step summaries, confidence, next steps)"
    - "User can click a 'Complete Workshop' button after the synthesis extraction has occurred"
    - "Clicking 'Complete Workshop' calls the server action and visually transitions Step 10 to a completed state"
    - "Completed state shows deliverable cards as active (no longer 'Coming Soon') with the PRD and Tech Specs cards enabled"
    - "Refreshing the page on a completed workshop shows the completed state persisted (button gone, cards active)"
  artifacts:
    - path: "src/components/workshop/step-container.tsx"
      provides: "Complete Workshop button + workshop completion state management"
      contains: "completeWorkshop"
    - path: "src/components/workshop/step-navigation.tsx"
      provides: "Complete Workshop button in bottom nav for Step 10"
      contains: "Complete Workshop"
    - path: "src/components/workshop/synthesis-summary-view.tsx"
      provides: "Deliverable cards reflect workshop completion state"
      contains: "workshopCompleted"
    - path: "src/components/workshop/deliverable-card.tsx"
      provides: "DeliverableCard unchanged (already supports disabled/enabled toggle)"
  key_links:
    - from: "src/components/workshop/step-navigation.tsx"
      to: "src/actions/workshop-actions.ts"
      via: "completeWorkshop server action call"
      pattern: "completeWorkshop"
    - from: "src/components/workshop/step-container.tsx"
      to: "src/components/workshop/step-navigation.tsx"
      via: "workshopCompleted prop + onCompleteWorkshop callback"
      pattern: "workshopCompleted|onCompleteWorkshop"
    - from: "src/components/workshop/step-container.tsx"
      to: "src/components/workshop/synthesis-summary-view.tsx"
      via: "workshopCompleted prop controls deliverable card enabled state"
      pattern: "workshopCompleted"
---

<objective>
Wire the "Complete Workshop" button into Step 10's UI so users can mark their workshop as done after the AI synthesis review. On completion, deliverable cards transition from "Coming Soon" to active, visually confirming the workshop is finished. This satisfies COMP-01 (AI-guided review visible) and COMP-02 (user can confirm completion).

Purpose: The AI synthesis review (COMP-01) already works via the extraction flow. This plan adds the explicit user action to complete the workshop (COMP-02) and wires the UI state to reflect completion.

Output: "Complete Workshop" button in Step 10 bottom nav, deliverable cards activated on completion, persisted state on refresh.
</objective>

<execution_context>
@/Users/michaelchristie/.claude/get-shit-done/workflows/execute-plan.md
@/Users/michaelchristie/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/43-workshop-completion/43-01-SUMMARY.md
@src/components/workshop/step-container.tsx
@src/components/workshop/step-navigation.tsx
@src/components/workshop/synthesis-summary-view.tsx
@src/components/workshop/deliverable-card.tsx
@src/actions/workshop-actions.ts
@src/db/schema/workshops.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Complete Workshop button to Step 10 navigation + wire completion state</name>
  <files>
    src/components/workshop/step-container.tsx
    src/components/workshop/step-navigation.tsx
  </files>
  <action>
**In step-container.tsx:**

1. Import `completeWorkshop` from `@/actions/workshop-actions`.

2. Add a new prop `workshopStatus` to StepContainerProps:
   ```
   workshopStatus?: 'draft' | 'active' | 'paused' | 'completed';
   ```

3. Add local state for tracking workshop-level completion:
   ```
   const [workshopCompleted, setWorkshopCompleted] = React.useState(workshopStatus === 'completed');
   const [isCompletingWorkshop, setIsCompletingWorkshop] = React.useState(false);
   ```

4. Add a `handleCompleteWorkshop` callback:
   - Set `isCompletingWorkshop(true)`
   - Call `await completeWorkshop(workshopId, sessionId)` inside try/catch with NEXT_REDIRECT guard
   - On success: `setWorkshopCompleted(true)`, fire confetti via `fireConfetti()`, show `toast.success('Workshop completed!')`
   - On error: `toast.error('Failed to complete workshop')`, log error
   - Finally: `setIsCompletingWorkshop(false)`

5. Pass to StepNavigation (when stepOrder === 10):
   - `onCompleteWorkshop={handleCompleteWorkshop}`
   - `isCompletingWorkshop={isCompletingWorkshop}`
   - `workshopCompleted={workshopCompleted}`
   - `canCompleteWorkshop={!!step10Artifact}` (extraction must have succeeded)

6. Pass `workshopCompleted` to SynthesisSummaryView and SynthesisBuildPackSection as a prop so deliverable cards can react to it (handled in Task 2).

**In step-navigation.tsx:**

1. Add new props to StepNavigationProps:
   ```
   onCompleteWorkshop?: () => void;
   isCompletingWorkshop?: boolean;
   workshopCompleted?: boolean;
   canCompleteWorkshop?: boolean;
   ```

2. In the right-side button area, update the `isLastStep` branch (currently renders `<div />` spacer):
   - If `workshopCompleted`: show a disabled green-tinted "Workshop Complete" badge/button using `variant="outline"` with a checkmark icon (CheckCircle2 from lucide-react) and olive text color `text-olive-700 dark:text-olive-400`. No click handler needed.
   - Else if `canCompleteWorkshop && !workshopCompleted`: show a "Complete Workshop" button using `variant="default"` and `size="lg"` with the `btn-shimmer` class (same shimmer pattern used for the confirmed Next button). On click, call `onCompleteWorkshop()`. Disable when `isCompletingWorkshop`. Show "Completing..." text with no chevron when loading.
   - Else (extraction not done yet): show the existing `<div />` spacer (no button).

**Note on `workshopStatus` prop:** The parent page at `src/app/workshop/[sessionId]/step/[stepId]/page.tsx` already queries the workshop. Add `workshopStatus={workshop.status}` to the StepContainer props there. Read the page.tsx file to find where StepContainer is rendered and add the prop.
  </action>
  <verify>
Run `npx tsc --noEmit` to confirm no type errors. Visually inspect that StepNavigation renders the "Complete Workshop" button only on Step 10 when extraction is done and workshop is not yet completed.
  </verify>
  <done>
Step 10 shows "Complete Workshop" button in bottom nav after extraction completes. Clicking it calls the server action, fires confetti, shows toast, and transitions to completed state. Completed state shows "Workshop Complete" badge. Refreshing page preserves completed state via workshopStatus prop from server.
  </done>
</task>

<task type="auto">
  <name>Task 2: Activate deliverable cards on workshop completion</name>
  <files>
    src/components/workshop/synthesis-summary-view.tsx
    src/components/workshop/step-container.tsx
  </files>
  <action>
**In synthesis-summary-view.tsx:**

1. Add `workshopCompleted?: boolean` prop to `SynthesisSummaryViewProps` and `SynthesisBuildPackSection` props.

2. In the Build Pack Deliverables section of `SynthesisSummaryView`, update the deliverable cards rendering:
   - For the PRD card (`id === 'prd'`): set `disabled={!workshopCompleted}` instead of `disabled={true}`. Set `buttonLabel` to `'Coming in Phase 44'` when not completed, and `'Ready'` when completed (Phase 44 will replace 'Ready' with actual download). Do NOT add an onDownload handler yet -- that is Phase 44's job.
   - For the Tech Specs card (`id === 'tech-specs'`): same pattern as PRD -- `disabled={!workshopCompleted}`, same button labels.
   - For Stakeholder Presentation (`id === 'stakeholder-ppt'`) and User Stories (`id === 'user-stories'`): keep `disabled={true}` -- these are out of scope for v1.7.

3. In `SynthesisBuildPackSection` (the standalone version shown before extraction): apply the same logic. The Billboard Hero and V0 Prototype cards keep their existing enabled/disabled logic. The PRD and Tech Specs cards follow the same `workshopCompleted` pattern as above.

4. Update the section heading when workshop is completed: change "Build Pack Deliverables" to include a subtle completion indicator. Add a small `CheckCircle2` icon (olive colored) next to the heading when `workshopCompleted` is true.

**In step-container.tsx:**

Pass `workshopCompleted={workshopCompleted}` to both `SynthesisSummaryView` and `SynthesisBuildPackSection` where they are rendered. Find all render locations of these components in the file (there are multiple for different panel layouts -- chat panel, right panel, mobile view) and add the prop to each.
  </action>
  <verify>
Run `npx tsc --noEmit` to confirm no type errors. Grep for `workshopCompleted` across the modified files to confirm it's wired through all render paths.
  </verify>
  <done>
Deliverable cards for PRD and Tech Specs transition from "Coming Soon" to "Ready" when workshop is completed. Stakeholder Presentation and User Stories remain disabled (out of v1.7 scope). The Build Pack section heading shows a completion indicator. All panel layouts (desktop chat, desktop right panel, mobile) pass workshopCompleted consistently.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with no errors
2. Step 10 bottom nav shows "Complete Workshop" button after extraction (not before)
3. Clicking "Complete Workshop" triggers confetti + toast + state transition
4. After completion, bottom nav shows "Workshop Complete" badge (olive themed, not clickable)
5. PRD and Tech Specs deliverable cards show as "Ready" (not "Coming Soon") after completion
6. Page refresh preserves completed state
7. Steps 1-9 navigation is unchanged (no regressions)
</verification>

<success_criteria>
- User on Step 10 sees AI synthesis review of all 10 steps (COMP-01 -- already working, just verify)
- User can click "Complete Workshop" to confirm completion (COMP-02)
- Completed state persists through page refresh (COMP-03 from Plan 01, verified here via UI)
- Deliverable cards activate on completion, signaling readiness for Phase 44
- Confetti and toast provide satisfying completion feedback
</success_criteria>

<output>
After completion, create `.planning/phases/43-workshop-completion/43-02-SUMMARY.md`
</output>
