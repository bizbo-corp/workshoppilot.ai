---
phase: 27-ui-kit-advanced-tools
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - src/lib/drawing/types.ts
  - src/lib/drawing/ui-kit-components.ts
  - src/components/ezydraw/palette/ui-kit-palette.tsx
  - src/components/ezydraw/palette/palette-item.tsx
autonomous: true

must_haves:
  truths:
    - "10 UI kit component factories exist and each returns valid DrawingElement arrays with groupId linking"
    - "UI kit palette sidebar renders with categorized components (Inputs, Layout, Content)"
    - "DrawingElement union includes SpeechBubbleElement and EmojiElement types for Phase 27-03"
    - "All new dependencies installed: @dnd-kit/core, @dnd-kit/utilities, @emoji-mart/data, @emoji-mart/react"
  artifacts:
    - path: "src/lib/drawing/ui-kit-components.ts"
      provides: "Factory functions for 10 UI kit components"
      exports: ["UI_KIT_COMPONENTS", "UIKitComponentType", "createButtonComponent", "createInputComponent", "createCardComponent", "createNavbarComponent", "createModalComponent", "createDropdownComponent", "createTabComponent", "createIconPlaceholderComponent", "createImagePlaceholderComponent", "createListItemComponent"]
    - path: "src/components/ezydraw/palette/ui-kit-palette.tsx"
      provides: "Categorized palette sidebar with search"
      exports: ["UIKitPalette"]
    - path: "src/components/ezydraw/palette/palette-item.tsx"
      provides: "Individual draggable palette item with preview"
      exports: ["PaletteItem"]
    - path: "src/lib/drawing/types.ts"
      provides: "Extended type system with groupId, SpeechBubbleElement, EmojiElement"
      contains: "groupId"
  key_links:
    - from: "src/components/ezydraw/palette/ui-kit-palette.tsx"
      to: "src/components/ezydraw/palette/palette-item.tsx"
      via: "renders PaletteItem for each component type"
      pattern: "PaletteItem.*componentType"
    - from: "src/components/ezydraw/palette/palette-item.tsx"
      to: "@dnd-kit/core"
      via: "useDraggable hook for drag behavior"
      pattern: "useDraggable"
    - from: "src/lib/drawing/ui-kit-components.ts"
      to: "src/lib/drawing/types.ts"
      via: "imports DrawingElement type and creates elements with groupId"
      pattern: "groupId"
---

<objective>
Install all Phase 27 dependencies, extend the drawing type system with groupId for compound shapes and new element types (SpeechBubbleElement, EmojiElement), create factory functions for all 10 UI kit wireframe components, and build the categorized palette sidebar UI.

Purpose: Establish the foundation for drag-and-drop UI kit features by defining all data shapes, component factories, and the visual palette that users will interact with. This is the prerequisite for both the dnd-kit integration (27-02) and the speech bubble/emoji tools (27-03).

Output: New dependencies installed, extended types, 10 component factories, palette sidebar component with categories and search.
</objective>

<execution_context>
@/Users/michaelchristie/.claude/get-shit-done/workflows/execute-plan.md
@/Users/michaelchristie/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/27-ui-kit-advanced-tools/27-RESEARCH.md

@src/lib/drawing/types.ts
@src/stores/drawing-store.ts
@src/components/ezydraw/toolbar.tsx
@src/components/ezydraw/ezydraw-stage.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install dependencies and extend drawing type system</name>
  <files>
    package.json
    src/lib/drawing/types.ts
  </files>
  <action>
    **Step 1: Install all Phase 27 dependencies in one command:**
    ```bash
    npm install @dnd-kit/core @dnd-kit/utilities @emoji-mart/data @emoji-mart/react
    ```

    **Step 2: Extend `src/lib/drawing/types.ts` with the following additions (do NOT remove existing types):**

    1. Add optional `groupId?: string` to `BaseElement` type. This links multiple elements that form a single UI kit component (e.g., button = rect + text). When present, all elements sharing the same groupId should be selected, moved, and deleted together.

    2. Add `SpeechBubbleElement` type:
    ```typescript
    export type SpeechBubbleElement = BaseElement & {
      type: 'speechBubble';
      width: number;
      height: number;
      tailX: number;  // Tail tip x offset relative to bubble origin
      tailY: number;  // Tail tip y offset relative to bubble origin
      text: string;
      fontSize: number;
      fill: string;
      stroke: string;
      strokeWidth: number;
      cornerRadius: number;
    };
    ```

    3. Add `EmojiElement` type (stamp-style, renders as large text):
    ```typescript
    export type EmojiElement = BaseElement & {
      type: 'emoji';
      emoji: string;    // Native emoji character (e.g., "star")
      fontSize: number; // Display size (default 48)
    };
    ```

    4. Update the `DrawingElement` union to include `| SpeechBubbleElement | EmojiElement`.

    5. Update `DrawingTool` to include `| 'speechBubble' | 'emoji'`.

    6. Add `UIKitGroupElement` helper type for readability (optional but useful):
    ```typescript
    /** Element that belongs to a compound UI kit component */
    export type UIKitGroupElement = DrawingElement & { groupId: string };
    ```

    Do NOT change `createElementId()` or any existing element types beyond adding the optional `groupId` to `BaseElement`.
  </action>
  <verify>
    - `npm ls @dnd-kit/core @dnd-kit/utilities @emoji-mart/data @emoji-mart/react` shows all four packages installed
    - `npx tsc --noEmit` passes with no type errors
    - types.ts exports SpeechBubbleElement, EmojiElement, UIKitGroupElement
  </verify>
  <done>
    All four Phase 27 dependencies are in package.json. Drawing type system includes groupId on BaseElement, SpeechBubbleElement, EmojiElement types, and updated DrawingElement union and DrawingTool type.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create UI kit component factories and palette sidebar</name>
  <files>
    src/lib/drawing/ui-kit-components.ts
    src/components/ezydraw/palette/ui-kit-palette.tsx
    src/components/ezydraw/palette/palette-item.tsx
  </files>
  <action>
    **Step 1: Create `src/lib/drawing/ui-kit-components.ts`** with factory functions for all 10 wireframe components. Each factory:
    - Takes `(x: number, y: number)` as arguments
    - Returns `DrawingElement[]` (array of elements that form the compound shape)
    - Generates a shared `groupId` using `createElementId()` prefixed with `group-`
    - Uses wireframe colors (grays, whites, light blues) NOT production colors

    The 10 components and their compositions:

    1. **button**: rect (120x40, fill #3B82F6, stroke #2563EB) + text ("Button", white, 16px)
    2. **input**: rect (200x36, fill white, stroke #D1D5DB) + text ("Enter text...", gray #9CA3AF, 14px)
    3. **card**: rect (240x160, fill white, stroke #E5E7EB) + line (horizontal divider at y+40) + text ("Card Title", 16px, dark) + text ("Card content", 14px, gray)
    4. **navbar**: rect (400x48, fill #F9FAFB, stroke #E5E7EB) + text ("Logo", 16px bold, left) + text ("Nav Item  Nav Item  Nav Item", 14px, right-aligned)
    5. **modal**: rect (300x200, fill white, stroke #D1D5DB, round corners implied) + line (divider at y+40) + text ("Modal Title", 16px, dark) + text ("Modal content area", 14px, gray) + rect (80x32, fill #3B82F6) at bottom-right + text ("OK", white, 14px)
    6. **dropdown**: rect (180x36, fill white, stroke #D1D5DB) + text ("Select...", 14px, gray) + text ("v", 14px, right side indicator)
    7. **tab**: rect (300x36, fill transparent, stroke none) composed of 3 sub-rects representing tabs: first tab (100x36, fill white, stroke-bottom blue) + second tab (100x36, fill #F3F4F6) + third tab (100x36, fill #F3F4F6), each with centered text label ("Tab 1", "Tab 2", "Tab 3")
    8. **iconPlaceholder**: rect (48x48, fill #F3F4F6, stroke #D1D5DB, dashed conceptually) + text ("icon", 12px, gray, centered)
    9. **imagePlaceholder**: rect (200x120, fill #F3F4F6, stroke #D1D5DB) + line (diagonal from top-left to bottom-right) + line (diagonal from top-right to bottom-left) + text ("Image", 14px, gray, centered)
    10. **listItem**: rect (280x48, fill white, stroke-bottom #E5E7EB) + rect (32x32, fill #F3F4F6 at left for avatar placeholder) + text ("List item text", 14px, dark)

    Export a `UI_KIT_COMPONENTS` registry object mapping component name to factory function, and export `UIKitComponentType` as `keyof typeof UI_KIT_COMPONENTS`.

    Also export a `UI_KIT_LABELS` record mapping UIKitComponentType to human-readable display names (e.g., `{ button: 'Button', iconPlaceholder: 'Icon Placeholder', imagePlaceholder: 'Image Placeholder', listItem: 'List Item' }`).

    **Step 2: Create `src/components/ezydraw/palette/palette-item.tsx`:**
    - Uses `useDraggable` from `@dnd-kit/core` with id `palette-${componentType}` and data `{ componentType }`
    - Renders a card-like div with:
      - A small SVG preview icon (simple inline SVG that hints at the component shape - rectangles, lines, etc.)
      - Component display name from UI_KIT_LABELS
      - "Drag to canvas" subtitle in gray
    - Applies opacity-50 when `isDragging` is true
    - Cursor: grab (move)
    - Must be 'use client' component

    **Step 3: Create `src/components/ezydraw/palette/ui-kit-palette.tsx`:**
    - Categories organized as:
      - "Inputs": button, input, dropdown
      - "Layout": card, navbar, modal, tab
      - "Content": iconPlaceholder, imagePlaceholder, listItem
    - Category tabs at top (horizontal, styled with Tailwind, active tab has blue border-bottom)
    - Optional search input that filters across all categories
    - Scrollable component list area below tabs
    - Each component renders as a `PaletteItem`
    - Width: `w-56` (224px, compact sidebar)
    - Must be 'use client' component
    - Background: `bg-gray-50`, border-right separator
  </action>
  <verify>
    - `npx tsc --noEmit` passes
    - `UI_KIT_COMPONENTS` exports exactly 10 factory functions
    - Each factory returns an array of DrawingElement with shared groupId
    - Palette renders 3 category tabs
    - `npm run build` succeeds (checks imports resolve)
  </verify>
  <done>
    All 10 UI kit factories return properly-typed DrawingElement arrays with groupId linking. Palette sidebar shows categorized, searchable component list with draggable items. PaletteItem uses dnd-kit's useDraggable for drag initiation.
  </done>
</task>

</tasks>

<verification>
1. `npm ls @dnd-kit/core @dnd-kit/utilities @emoji-mart/data @emoji-mart/react` - all installed
2. `npx tsc --noEmit` - no type errors
3. `npm run build` - build succeeds
4. types.ts has: groupId on BaseElement, SpeechBubbleElement, EmojiElement, updated union
5. ui-kit-components.ts exports UI_KIT_COMPONENTS with 10 entries
6. Each factory returns DrawingElement[] with shared groupId
7. Palette has 3 categories with correct component assignments
</verification>

<success_criteria>
- All 4 new npm packages installed and importable
- DrawingElement union includes SpeechBubbleElement and EmojiElement
- BaseElement has optional groupId field
- 10 UI kit component factories produce valid DrawingElement arrays
- Palette sidebar renders with categories, search, and draggable items
- Build passes with no TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/27-ui-kit-advanced-tools/27-01-SUMMARY.md`
</output>
