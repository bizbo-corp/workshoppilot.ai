---
phase: 42-visual-polish
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/workshop/step-transition-wrapper.tsx
  - src/components/workshop/step-container.tsx
  - src/components/workshop/chat-skeleton.tsx
  - src/components/workshop/chat-panel.tsx
  - src/components/dashboard/workshop-grid-skeleton.tsx
  - src/components/dashboard/workshop-grid.tsx
  - src/app/dashboard/page.tsx
  - src/app/workshop/[sessionId]/step/[stepId]/page.tsx
autonomous: true
requirements:
  - VISL-01
  - VISL-02
  - VISL-04

must_haves:
  truths:
    - "Navigating between workshop steps produces a smooth fade-in transition instead of an instant content swap"
    - "Dashboard shows static gray skeleton blocks while workshop data loads"
    - "Chat panel shows message-shaped skeleton placeholders while conversation history loads"
    - "No shimmer or pulse animation on skeletons — static gray blocks only"
    - "Chat action buttons use bg-card instead of bg-white for proper dark mode behavior"
    - "Step container fullscreen close button uses token-aware background"
  artifacts:
    - path: "src/components/workshop/step-transition-wrapper.tsx"
      provides: "Fade-in wrapper for step content transitions"
      contains: "opacity"
    - path: "src/components/workshop/chat-skeleton.tsx"
      provides: "Static skeleton for chat message history"
      contains: "Skeleton"
    - path: "src/components/dashboard/workshop-grid-skeleton.tsx"
      provides: "Static skeleton for dashboard workshop cards"
      contains: "Skeleton"
  key_links:
    - from: "src/components/workshop/step-container.tsx"
      to: "src/components/workshop/step-transition-wrapper.tsx"
      via: "wraps step content with fade-in"
      pattern: "StepTransitionWrapper"
    - from: "src/components/workshop/chat-panel.tsx"
      to: "src/components/workshop/chat-skeleton.tsx"
      via: "shows skeleton while messages load"
      pattern: "ChatSkeleton"
    - from: "src/components/dashboard/workshop-grid.tsx"
      to: "src/components/dashboard/workshop-grid-skeleton.tsx"
      via: "shows skeleton while workshops load"
      pattern: "WorkshopGridSkeleton"
---

<objective>
Add page/route transitions and loading skeletons for content areas

Purpose: Content areas that currently flash or pop in during data fetch need skeleton placeholders, and navigating between workshop steps needs a smooth transition. This makes the app feel polished and intentional rather than jarring.

Output: Step transitions fade in (150-200ms), dashboard shows card-shaped skeletons during load, chat panel shows message-shaped skeletons during load. All skeletons are static gray blocks (no shimmer/pulse per user decision).
</objective>

<execution_context>
@/Users/michaelchristie/.claude/get-shit-done/workflows/execute-plan.md
@/Users/michaelchristie/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/components/ui/skeleton.tsx
@src/components/canvas/canvas-loading-skeleton.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create step transition wrapper and integrate into step container</name>
  <files>
    src/components/workshop/step-transition-wrapper.tsx
    src/components/workshop/step-container.tsx
  </files>
  <action>
Create a `StepTransitionWrapper` client component that wraps step content and applies a fade-in animation when the step changes (detected by a `stepId` key prop).

Implementation approach: Use CSS transitions (NOT framer-motion — keep it lightweight). The component should:
1. Accept `children` and a `stepId` string prop
2. Use a `key={stepId}` to re-mount on step change
3. Apply an initial opacity of 0 that transitions to 1 over 150ms with `ease-out`
4. Use a CSS class approach: define a `step-fade-in` keyframe in the component's inline style or via a `useEffect` that adds/removes a class
5. Both panels (chat + canvas) should be inside the same wrapper so they transition together as a unified view per user decision

Simplest approach: Use a `useEffect` on mount to trigger the animation. On mount, set opacity to 0 then requestAnimationFrame to set it to 1 with a CSS `transition: opacity 150ms ease-out`.

In `step-container.tsx`, wrap the main content area (the section containing both the chat panel and the canvas/right panel) with `<StepTransitionWrapper stepId={currentStepId}>`. The wrapper should surround the `PanelGroup` or equivalent top-level content container — NOT the sidebar or mobile stepper.

**Also in `step-container.tsx` (olive audit — absorbed from plan 01):** Find the fullscreen close button (approximately line 595) with `bg-white/10 ... hover:bg-white/20` — replace with `bg-background/10 ... hover:bg-background/20` so it uses token-aware references.

Do NOT add transitions to:
- The sidebar (it's persistent across steps)
- The mobile tab bar (persistent)
- Panel resize handles (persistent)
  </action>
  <verify>
Run: `npm run build` — should complete without type errors.
Verify `StepTransitionWrapper` is imported and used in `step-container.tsx`.
Run: `grep -n 'bg-white' src/components/workshop/step-container.tsx` — should return 0 matches.
  </verify>
  <done>Step navigation produces a subtle 150ms fade-in. Both chat and canvas panels transition together. No jarring content swap. Fullscreen close button uses token-aware background.</done>
</task>

<task type="auto">
  <name>Task 2: Create loading skeletons for dashboard and chat panel</name>
  <files>
    src/components/workshop/chat-skeleton.tsx
    src/components/dashboard/workshop-grid-skeleton.tsx
    src/components/workshop/chat-panel.tsx
    src/components/dashboard/workshop-grid.tsx
    src/app/dashboard/page.tsx
    src/app/workshop/[sessionId]/step/[stepId]/page.tsx
  </files>
  <action>
**Per user decision: skeletons must be static gray blocks — NO shimmer, NO pulse animation.**

Override the default shadcn Skeleton behavior which uses `animate-pulse`. When creating skeleton instances, add `animate-none` class to override the pulse: `<Skeleton className="h-4 w-32 animate-none" />`. Alternatively, create skeleton blocks with `<div className="bg-accent rounded-md h-4 w-32" />` (same visual as Skeleton but without animation).

**ChatSkeleton component** (`src/components/workshop/chat-skeleton.tsx`):
- Create a client component that renders 4-5 message-shaped skeleton blocks
- Alternate between left-aligned (AI messages, wider ~70%) and right-aligned (user messages, narrower ~40%)
- Each block: rounded rectangle, bg-accent (matches Skeleton base), no animation
- Include a small circular avatar skeleton next to AI messages
- Layout-accurate: match the chat message spacing and padding from the actual chat panel

**WorkshopGridSkeleton component** (`src/components/dashboard/workshop-grid-skeleton.tsx`):
- Create a component that renders 3-4 card-shaped skeleton blocks in a grid
- Each card skeleton: match the workshop card dimensions — header area with circle + title line, body with 2 short lines, footer with button-shaped rectangle
- Use `bg-accent rounded-md` for each skeleton element, no animation
- Grid layout should match the existing workshop card grid (responsive columns)

**Integration:**

In `chat-panel.tsx`: Show `ChatSkeleton` when messages are loading (before `initialMessages` have loaded). Look for the existing loading state — if messages array is empty and the component is in a loading state, render `ChatSkeleton`. If there is no explicit loading state, add a brief `isLoading` state that shows the skeleton on mount and hides it once messages are available (even if the array is empty — empty means loaded, not loading).

**Also in `chat-panel.tsx` (olive audit — absorbed from plan 01):** Replace all `bg-white` on the action buttons (approximately lines 2543, 2570, 2588, 2620) with `bg-card`. These are the inline action buttons (sticky note, extract, navigate, etc.) that currently render with a white background that breaks dark mode. The dark mode variant (`dark:bg-neutral-olive-800`) is already correct — only the light mode `bg-white` needs to become `bg-card`. Do NOT touch: post-it note color classes (yellow, red, blue, green, pink, orange) — these are intentional; `text-white` on gradient headers — these are over dark backgrounds; color picker swatches — these are literal color samples.

In `workshop-grid.tsx` or `src/app/dashboard/page.tsx`: Use React `Suspense` boundary around the workshop grid with `WorkshopGridSkeleton` as the fallback. Since the dashboard page is a server component that fetches data, the Suspense boundary should wrap the data-dependent content.

For the step page (`src/app/workshop/[sessionId]/step/[stepId]/page.tsx`): If there is any loading state before the step container renders, show a skeleton. Check current implementation — if the page is already server-rendered with data, a skeleton may not be needed here. Only add if there is a visible flash during data fetch.
  </action>
  <verify>
Run: `npm run build` — should complete without type errors.
Verify `ChatSkeleton` is imported in `chat-panel.tsx`.
Verify `WorkshopGridSkeleton` exists and is referenced in the dashboard page or workshop-grid.
Run: `grep -n 'animate-pulse' src/components/workshop/chat-skeleton.tsx src/components/dashboard/workshop-grid-skeleton.tsx` — should return 0 matches (no pulse animation).
Run: `grep -n 'bg-white' src/components/workshop/chat-panel.tsx` — should return 0 matches (olive audit).
  </verify>
  <done>Chat panel shows message-shaped static gray skeletons during load. Dashboard shows card-shaped static gray skeletons during load. No shimmer or pulse animation on any skeleton. Chat action buttons use bg-card instead of bg-white.</done>
</task>

</tasks>

<verification>
1. `npm run build` — passes
2. Step navigation between steps shows smooth 150ms fade-in
3. `grep -rn 'animate-pulse' src/components/workshop/chat-skeleton.tsx src/components/dashboard/workshop-grid-skeleton.tsx` — 0 matches
4. Dashboard page has Suspense with skeleton fallback or equivalent loading state
5. Chat panel shows skeleton before messages load
6. `grep -rn 'bg-white' src/components/workshop/chat-panel.tsx src/components/workshop/step-container.tsx` — 0 matches (olive audit)
</verification>

<success_criteria>
- StepTransitionWrapper wraps step content with 150ms fade-in transition
- ChatSkeleton renders static gray message-shaped blocks (no animation)
- WorkshopGridSkeleton renders static gray card-shaped blocks (no animation)
- Both skeletons integrated into their respective components
- Zero bg-white classes in chat-panel.tsx and step-container.tsx (olive audit)
- Build passes without errors
</success_criteria>

<output>
After completion, create `.planning/phases/42-visual-polish/42-02-SUMMARY.md`
</output>
