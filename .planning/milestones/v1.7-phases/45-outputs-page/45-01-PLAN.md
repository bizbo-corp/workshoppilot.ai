---
phase: 45-outputs-page
plan: "01"
type: execute
wave: 1
depends_on: []
files_modified:
  - src/app/api/workshops/[workshopId]/outputs/route.ts
  - src/app/workshop/[sessionId]/outputs/page.tsx
  - src/app/workshop/[sessionId]/outputs/outputs-content.tsx
autonomous: true
requirements: [OUT-01, OUT-02, OUT-07]

must_haves:
  truths:
    - "User can navigate to /workshop/[sessionId]/outputs and see the page load"
    - "Page displays a card for each generated deliverable (PRD, Tech Specs)"
    - "Page shows a link back to the workshop step view for review"
    - "Unauthenticated user is redirected, not shown deliverables"
  artifacts:
    - path: "src/app/api/workshops/[workshopId]/outputs/route.ts"
      provides: "GET endpoint returning build_pack rows for a workshop"
      exports: ["GET"]
    - path: "src/app/workshop/[sessionId]/outputs/page.tsx"
      provides: "Server component that loads session, workshop, and build_pack data"
      min_lines: 30
    - path: "src/app/workshop/[sessionId]/outputs/outputs-content.tsx"
      provides: "Client component rendering deliverable cards and back link"
      min_lines: 40
  key_links:
    - from: "src/app/workshop/[sessionId]/outputs/page.tsx"
      to: "db.query.sessions"
      via: "drizzle query"
      pattern: "db\\.query\\.sessions\\.findFirst"
    - from: "src/app/workshop/[sessionId]/outputs/page.tsx"
      to: "build_packs table"
      via: "drizzle select"
      pattern: "from\\(buildPacks\\)"
    - from: "src/app/workshop/[sessionId]/outputs/outputs-content.tsx"
      to: "/workshop/[sessionId]/step"
      via: "Link component"
      pattern: "href=.*workshop.*step"
---

<objective>
Create the outputs page at `/workshop/[sessionId]/outputs` with deliverable cards and a GET API route.

Purpose: Users need a dedicated page to view, interact with, and download their generated Build Pack deliverables (PRD, Tech Specs) after completing a workshop. This plan creates the page shell, data loading, and card display.

Output: Working outputs page with deliverable cards showing title, description, and format badges. API route for client-side data fetching. Back link to workshop.
</objective>

<execution_context>
@/Users/michaelchristie/.claude/get-shit-done/workflows/execute-plan.md
@/Users/michaelchristie/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@.planning/phases/44-ai-deliverable-generation/44-01-SUMMARY.md
@.planning/phases/44-ai-deliverable-generation/44-02-SUMMARY.md

@src/db/schema/build-packs.ts
@src/app/workshop/[sessionId]/results/page.tsx
@src/app/workshop/[sessionId]/results/results-content.tsx
@src/app/workshop/[sessionId]/layout.tsx
@src/components/workshop/deliverable-card.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create GET API route for workshop outputs</name>
  <files>src/app/api/workshops/[workshopId]/outputs/route.ts</files>
  <action>
Create a GET endpoint at `/api/workshops/[workshopId]/outputs` that:

1. Extracts `workshopId` from the route params (Next.js 16 async params pattern: `const { workshopId } = await params;`)
2. Auth check: `const { userId } = await auth();` — return 401 if no userId
3. Ownership check: query `workshops` table for the workshopId, verify `clerkUserId === userId` — return 403 if mismatch
4. Query `build_packs` table: `db.select().from(buildPacks).where(eq(buildPacks.workshopId, workshopId)).orderBy(buildPacks.createdAt)`
5. Group results by deliverable type using title prefix detection:
   - Title starting with `PRD:` → type `prd`
   - Title starting with `Tech Specs:` → type `tech-specs`
   - Other → type `other`
6. For each group, return: `{ type, title, formats: [{ formatType, content, createdAt, updatedAt }] }`
7. Return 200 with `{ deliverables: [...] }`

Import patterns — follow the existing generate-prd route:
- `import { auth } from '@clerk/nextjs/server';`
- `import { db } from '@/db/client';`
- `import { buildPacks, workshops } from '@/db/schema';`
- `import { eq } from 'drizzle-orm';`

Error responses: 401 for unauthenticated, 403 for forbidden, 500 for unexpected errors. Use `new Response(JSON.stringify({...}), { status, headers: { 'Content-Type': 'application/json' } })` pattern matching existing routes.
  </action>
  <verify>Run `npx tsc --noEmit` — no type errors in the new route file.</verify>
  <done>GET /api/workshops/[workshopId]/outputs returns grouped deliverables with auth + ownership checks.</done>
</task>

<task type="auto">
  <name>Task 2: Create outputs page with deliverable cards and back link</name>
  <files>
    src/app/workshop/[sessionId]/outputs/page.tsx
    src/app/workshop/[sessionId]/outputs/outputs-content.tsx
  </files>
  <action>
**page.tsx (Server Component):**

Follow the exact pattern from `src/app/workshop/[sessionId]/results/page.tsx`:

1. Accept `params: Promise<{ sessionId: string }>` (Next.js 16 async params)
2. Await params: `const { sessionId } = await params;`
3. Load session with workshop: `db.query.sessions.findFirst({ where: eq(sessions.id, sessionId), with: { workshop: true } })`
4. If no session, `redirect('/dashboard')`
5. Load build_packs for this workshop: `db.select().from(buildPacks).where(eq(buildPacks.workshopId, workshop.id)).orderBy(buildPacks.createdAt)`
6. Group the rows into deliverables — each deliverable has a `type` (prd, tech-specs), `title`, and `formats` array with `{ formatType, content, id }`
   - Group by title prefix: `PRD:` → prd, `Tech Specs:` → tech-specs
7. Render `<OutputsContent sessionId={sessionId} workshopId={workshop.id} workshopTitle={workshop.title} deliverables={deliverables} />`

Imports: `import { redirect } from 'next/navigation';`, `import { eq } from 'drizzle-orm';`, `import { db } from '@/db/client';`, `import { sessions, buildPacks } from '@/db/schema';`, `import { OutputsContent } from './outputs-content';`

**outputs-content.tsx (Client Component):**

`'use client';` at top.

Define a `Deliverable` interface:
```ts
interface DeliverableFormat {
  id: string;
  formatType: 'markdown' | 'json' | 'pdf';
  content: string | null;
}
interface Deliverable {
  type: string;
  title: string;
  formats: DeliverableFormat[];
}
interface OutputsContentProps {
  sessionId: string;
  workshopId: string;
  workshopTitle: string;
  deliverables: Deliverable[];
}
```

Render:
1. Page header: "Build Pack" as h1, workshop title as subtitle
2. Back link: `<Link href={/workshop/${sessionId}/step/10}>` with ArrowLeft icon and text "Back to Workshop" — uses olive-themed link style (text-primary hover:text-primary/80)
3. If deliverables is empty: show an empty state card: "No deliverables generated yet. Complete your workshop and generate deliverables from Step 10."
4. If deliverables exist: render a grid of cards (1 col on mobile, 2 cols on sm+)
   - Each card shows: icon (FileText for PRD, Code for Tech Specs), title (strip the prefix — "PRD: ProductName" becomes "Product Requirements Document"), description, format badges (Markdown, JSON pills)
   - Use the existing Card, CardHeader, CardTitle, CardDescription from shadcn
   - Each card is clickable — for now, set `onClick` to a state setter for `selectedDeliverable` (used in Plan 02)
   - Show a "View Details" button on each card

State management: `const [selectedType, setSelectedType] = useState<string | null>(null);` — this will be used by Plan 02's detail view. For now, clicking a card just sets selectedType.

Olive theming: follow existing patterns — bg-card borders, text-foreground, text-muted-foreground, hover:bg-accent.

Layout: `<div className="h-full overflow-y-auto"><div className="mx-auto max-w-4xl px-6 py-8 space-y-8">` — consistent with results page.
  </action>
  <verify>Run `npx tsc --noEmit` — no type errors. Navigate to `/workshop/[sessionId]/outputs` in the browser — page renders within the workshop layout (sidebar + header inherited from layout.tsx). Cards show for each deliverable.</verify>
  <done>Outputs page loads at /workshop/[sessionId]/outputs showing deliverable cards with back link to workshop. Page uses workshop layout (sidebar, header) via inherited layout.tsx.</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with zero errors
2. `/workshop/[sessionId]/outputs` page loads with workshop layout
3. Deliverable cards render for PRD and Tech Specs (if generated)
4. Empty state renders when no deliverables exist
5. Back link to workshop step 10 is present and navigable
6. API route returns 401 for unauthenticated requests
</verification>

<success_criteria>
- Outputs page is accessible at /workshop/[sessionId]/outputs
- Page displays deliverable cards for PRD and Tech Specs
- Page includes a back link to the workshop for review
- API route correctly returns build pack data with auth protection
- Page renders within existing workshop layout (sidebar, header)
</success_criteria>

<output>
After completion, create `.planning/phases/45-outputs-page/45-01-SUMMARY.md`
</output>
