---
phase: 36-olive-theme-rollout
plan: 04
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/canvas/persona-template-node.tsx
  - src/components/canvas/hmw-card-node.tsx
  - src/components/canvas/mind-map-node.tsx
  - src/components/canvas/cluster-hulls-overlay.tsx
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Zero bg-white/N alpha-variant classes remain in any canvas node file"
    - "Persona node editable fields show olive-tinted focus highlight, not white flash, in dark mode"
    - "Mind map action button hover shows olive tint, not white overlay, in dark mode"
    - "grep -rn 'bg-white' src/components/ returns zero matches"
  artifacts:
    - path: "src/components/canvas/persona-template-node.tsx"
      provides: "Olive-themed focus states on editable fields and hover overlay"
      contains: "focus:bg-card/60"
    - path: "src/components/canvas/hmw-card-node.tsx"
      provides: "Olive-themed focus state on inline edit field"
      contains: "focus:bg-card/60"
    - path: "src/components/canvas/mind-map-node.tsx"
      provides: "Olive-themed hover state on action button"
      contains: "hover:bg-neutral-olive-100/50"
    - path: "src/components/canvas/cluster-hulls-overlay.tsx"
      provides: "Olive-tinted input background on colored hull headers"
      contains: "bg-neutral-olive-50/20"
  key_links:
    - from: "src/components/canvas/persona-template-node.tsx"
      to: "globals.css"
      via: "bg-card CSS token"
      pattern: "bg-card"
    - from: "src/components/canvas/mind-map-node.tsx"
      to: "globals.css"
      via: "neutral-olive Tailwind scale"
      pattern: "bg-neutral-olive-100"
---

<objective>
Close the 4 verification gaps where canvas node files retain `bg-white/N` alpha-variant classes on visible interactive states (focus, hover). These were missed by plans 01-03 because the grep verification pattern checked `bg-white` but not `bg-white/60`, `bg-white/50`, `bg-white/20`, `bg-white/90`.

Purpose: Achieve a fully clean olive theme with zero `bg-white` references in component files -- completing the "single coherent product" goal for Truth 2 (canvas backgrounds and post-it node colors match the olive-tinted palette in both light and dark modes).

Output: 4 canvas node files with all `bg-white/N` classes replaced by olive-tinted equivalents.
</objective>

<execution_context>
@/Users/michaelchristie/.claude/get-shit-done/workflows/execute-plan.md
@/Users/michaelchristie/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/36-olive-theme-rollout/36-VERIFICATION.md

# Source files with gaps
@src/components/canvas/persona-template-node.tsx
@src/components/canvas/hmw-card-node.tsx
@src/components/canvas/mind-map-node.tsx
@src/components/canvas/cluster-hulls-overlay.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Replace bg-white/N on persona-template-node and hmw-card-node editable fields</name>
  <files>
    src/components/canvas/persona-template-node.tsx
    src/components/canvas/hmw-card-node.tsx
  </files>
  <action>
In persona-template-node.tsx, make 6 replacements:

1. Line 168: `bg-white/90` on hover portrait overlay button div -> replace with `bg-card/90`. This is the "Regenerate" pill that appears over the portrait photo on hover. `bg-card` resolves to neutral-olive-50 (light) / neutral-olive-900 (dark), giving an olive-tinted overlay instead of a bright white pill.

2. Lines 235, 261, 280: `focus:bg-white/60` on 3 editable field inputs (name, demographics, additional fields) -> replace with `focus:bg-card/60`. These fields sit on a `bg-card` node surface, so using `bg-card/60` for the focus highlight is semantically correct and avoids the white flash in dark mode.

3. Lines 335, 341: `focus:bg-white/15` on the 2 header band editable fields (archetype title, archetype role) -> replace with `focus:bg-neutral-olive-100/15`. These fields render on the SAGE.headerBg olive (#6b7f4e) background. The `text-white` and `text-white/75` on these lines are INTENTIONAL (white text on olive background for readability) -- do NOT change them. Only change the `focus:bg-white/15` to `focus:bg-neutral-olive-100/15` so the focus highlight uses an olive-compatible tint instead of raw white.

In hmw-card-node.tsx, make 1 replacement:

4. Line 74: `focus:bg-white/60` on the inline editable input -> replace with `focus:bg-card/60`. Same pattern as persona-template-node editable fields.

IMPORTANT: Do NOT change `text-white`, `text-white/75`, `placeholder:text-white/40`, or `placeholder:text-white/30` on lines 335 and 341 of persona-template-node.tsx. These are intentional white text on olive headerBg.
  </action>
  <verify>
Run: `grep -n 'bg-white' src/components/canvas/persona-template-node.tsx src/components/canvas/hmw-card-node.tsx`
Expected: Zero matches. (text-white references will still exist on lines 335/341 but grep for `bg-white` specifically should return nothing.)

Run: `grep -n 'focus:bg-card/60' src/components/canvas/persona-template-node.tsx`
Expected: 3 matches (lines ~235, ~261, ~280).

Run: `grep -n 'focus:bg-neutral-olive-100/15' src/components/canvas/persona-template-node.tsx`
Expected: 2 matches (lines ~335, ~341).

Run: `grep -n 'focus:bg-card/60' src/components/canvas/hmw-card-node.tsx`
Expected: 1 match (line ~74).
  </verify>
  <done>
persona-template-node.tsx has zero bg-white classes: hover overlay uses bg-card/90, body field focus uses focus:bg-card/60, header field focus uses focus:bg-neutral-olive-100/15. hmw-card-node.tsx inline edit focus uses focus:bg-card/60. White text on olive header band is preserved.
  </done>
</task>

<task type="auto">
  <name>Task 2: Replace bg-white/N on mind-map-node and cluster-hulls-overlay</name>
  <files>
    src/components/canvas/mind-map-node.tsx
    src/components/canvas/cluster-hulls-overlay.tsx
  </files>
  <action>
In mind-map-node.tsx, make 1 replacement:

1. Line 140: `hover:bg-white/50` on the "+Branch" / "+Child" action button -> replace with `hover:bg-neutral-olive-100/50`. The button's text color comes from `data.themeColor` (user-set). Using `bg-neutral-olive-100/50` gives a subtle warm olive hover tint instead of a bright white overlay. This works on both light and dark canvas because the 50% alpha is transparent enough to blend.

In cluster-hulls-overlay.tsx, make 1 replacement:

2. Line 235: `bg-white/20` on the cluster rename input -> replace with `bg-neutral-olive-50/20`. This input renders inside a hull header whose background is one of 6 HULL_COLORS headerBg values (indigo, green, amber, red, purple, sky at 0.65 alpha). The `bg-neutral-olive-50/20` at 20% alpha will be nearly invisible against these colored backgrounds (same as bg-white/20 was), but uses an olive-system color instead of raw white. Do NOT change `text-white` or `placeholder-white/50` on this same line -- white text on the colored hull headers is intentional for readability. Similarly do NOT change `text-white` on line 258 (the non-editing span display of cluster name).
  </action>
  <verify>
Run: `grep -n 'bg-white' src/components/canvas/mind-map-node.tsx src/components/canvas/cluster-hulls-overlay.tsx`
Expected: Zero matches.

Run: `grep -n 'hover:bg-neutral-olive-100/50' src/components/canvas/mind-map-node.tsx`
Expected: 1 match (line ~140).

Run: `grep -n 'bg-neutral-olive-50/20' src/components/canvas/cluster-hulls-overlay.tsx`
Expected: 1 match (line ~235).

Final project-wide sweep:
Run: `grep -rn 'bg-white' src/components/ src/app/`
Expected: Zero matches in all component and app files.
  </verify>
  <done>
mind-map-node.tsx action button hover uses hover:bg-neutral-olive-100/50. cluster-hulls-overlay.tsx rename input background uses bg-neutral-olive-50/20. White text on colored hull headers is preserved. Project-wide sweep for bg-white returns zero matches across src/components/ and src/app/.
  </done>
</task>

</tasks>

<verification>
1. `grep -rn 'bg-white' src/components/ src/app/` returns zero matches
2. `grep -rn 'bg-white/' src/components/ src/app/` returns zero matches (alpha variants specifically)
3. `text-white` instances on persona-template-node.tsx lines 335/341 and cluster-hulls-overlay.tsx lines 235/258 are preserved (intentional white text on colored backgrounds)
4. `npm run build` completes without new errors (pre-existing seed route error is acceptable)
</verification>

<success_criteria>
- All 4 canvas node files have zero `bg-white` or `bg-white/N` classes
- Project-wide `grep -rn 'bg-white' src/` returns zero matches
- Intentional `text-white` on olive and colored backgrounds is preserved
- No visual regressions in light mode (replacements use semantically equivalent olive tokens)
- Build succeeds with no new errors
</success_criteria>

<output>
After completion, create `.planning/phases/36-olive-theme-rollout/36-04-SUMMARY.md`
</output>
